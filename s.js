document.addEventListener("DOMContentLoaded",function(){const H='<svg id="closeSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M228 1.1c-50.8 5-99.1 24.6-137.9 55.9C22.8 111.4-11.5 206.2 4 295.5c12.6 72.1 54 135.3 114.5 174.8 86.3 56.2 198.8 55.3 285-2.4 23.9-16 39.8-30.8 56-52.4 42.9-57 60.4-129 48.5-199.2-17.4-102.1-93.8-184-194.7-208.8-24.9-6.1-60.9-8.8-85.3-6.4zm63 50.8c85.2 15.2 151.5 79.4 168.4 163.3C480 316.8 420.6 419 322 452c-75.4 25.2-159.6 4.6-215.1-52.7-47.4-48.9-67.2-117.7-53.4-185.8 6.2-30.8 20.8-62 40.8-87.3 18.4-23.3 46.7-45.5 74.5-58.4 17.5-8.1 43.1-15.3 63.2-17.8 12.7-1.5 45.9-.5 59 1.9zm-137.6 88c-10.5 4.8-16 13.9-15.2 25.1.3 3.8 1.4 8.1 2.6 10.5 1.2 2.3 17.9 19.8 40.1 42l38.1 38-38.5 38.5c-42.2 42.3-42.4 42.6-42.5 53.9 0 10.8 5.5 19.1 15.9 23.9 4.4 2 6.4 2.4 11.5 2 3.4-.3 7.7-1.3 9.6-2.3 1.9-.9 20.9-19.1 42.3-40.3l38.7-38.7 38.8 38.7c21.3 21.2 40.3 39.4 42.2 40.4 4.8 2.5 17.1 2.6 22.1.1 4.8-2.4 10.3-7.9 12.5-12.6 1-2 2-6.4 2.2-9.9.8-11.9 1.3-11.3-41.9-54.7l-38.9-39 38-38c25.9-25.9 38.7-39.4 40.1-42.3 3.1-6.4 3.6-15.7 1.2-21.3-4.8-10.7-12.6-15.9-23.9-15.9-11.8.1-11.8.1-54.1 42.3L256 218.4l-38.2-38.1c-28.5-28.4-39.5-38.7-42.8-40.2-5.9-2.7-15.9-2.8-21.6-.2z"/></svg>',$='<svg id="editSVG" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M414.1 7.5c-3 .9-7.5 2.7-10.1 4.1-3.2 1.7-57.3 55.2-176.8 174.7L52.4 362c-4.9 6.6-8.5 15.2-18 42.3L21.5 441C11.7 468.3 3 494.4 3 496.7c0 7.2 7.2 14.3 14.7 14.3 2.6 0 12-2.8 25.5-7.4L96.5 485l38.5-13.5c16.2-6.1 7.3 2.3 193.1-183.5C518 98.3 505.8 111.3 508.3 96.6c.8-4.9.8-8.3 0-13.2-2.2-12.9-4.3-15.7-30.1-41.2L449.8 15c-9.2-7.5-24.4-10.6-35.7-7.5zM436 24.3c6.3 2.9 52.1 48.2 55.2 54.6 3 6.3 3 15.9 0 22.1-1.4 2.9-8.1 10.4-18.7 21L456 138.5 416.5 99 377 58.4c0-1.6 31.1-31.9 34.8-33.8 7.5-3.9 16.3-4 24.2-.3zM237.8 227.8L89.7 375.1c-3.8 3-5.7 3.9-8.7 3.9-7.3 0-12.4-7-10-13.6.7-1.7 60.5-62.3 147.8-149.6L365.5 69l7.7 7.7 7.8 7.8-143.2 143.3zM406 110.1l13.3 14.1-143.4 143.4-147.1 145.5c-12 6.2-28.8-4.3-28.8-18.1 0-8.5-2.7-5.7 147.8-155.7L392.1 96.1c.4-.1 6.6 6.2 13.9 14zM297.1 297.4L149.2 445.3l-4.2-.6c-2.3-.3-5.3-1.5-6.6-2.8-2.7-2.5-4.1-8.1-2.8-11 .5-1.1 67-68.1 147.9-148.9l147-147 7.3 7.3 7.2 7.2-147.9 147.9zM69 391.4c3.7 2 6.8 2.9 10.5 3l5.3.1.5 5.1c1.5 14.3 15.3 28.4 29.5 30.1l4.9.5.5 6.2c.6 7.3 2.5 11.4 7.7 16.4l3.9 3.7-32.6 11.3-32.5 11.3-15.4-15.3c-8.4-8.4-15.3-15.9-15.3-16.6s5-15.7 11.2-33.3L58.4 382l2.7 3.3c1.5 1.8 5 4.5 7.9 6.1zM40.5 474c5.4 5.4 9.6 10.2 9.2 10.6-.8.9-30.1 11.2-30.6 10.8S29.4 464 30 464c.3 0 5 4.5 10.5 10z"/></svg>',q='<svg id="deleteSVG" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M202.1 1.1c-12.8 2.5-25.7 12.5-31.1 24.1-3.7 7.9-5 14.6-5 25.9V60h-46.4c-27.3 0-48.5.4-51.7 1-18 3.4-32.5 17.9-35.9 35.9-.5 3-1 13.4-1 23.3 0 15.9.2 18.3 2 21.8 3.1 6.1 7.8 8 19.4 8h9.5l.5 4.2c.4 2.4 6.4 75.4 13.5 162.3 13.8 168.3 13.4 164.8 19.5 174.4 6.4 10 18 17.9 29.5 20.1 7.3 1.4 254.9 1.4 262.2 0 11.5-2.2 23.1-10.1 29.5-20.1 6.1-9.6 5.7-6.1 19.5-174.4l13.5-162.3.5-4.2h9.5c11.6 0 16.3-1.9 19.4-8 1.8-3.5 2-5.9 2-21.8 0-9.9-.5-20.3-1-23.3-3.4-18-17.9-32.5-35.9-35.9-3.2-.6-24.4-1-51.7-1H346v-8.9c0-4.8-.5-11.2-1-14.2-3.4-18-17.9-32.5-35.9-35.9-6.5-1.2-100.6-1.2-107 .1zM308 32c6 3.1 8 7.8 8 19v9h-60-60v-9c0-11 2-15.9 7.8-18.9 3.5-1.9 5.9-2 52-2.1 46.5 0 48.4.1 52.2 2zm135 60c6 3.1 8 7.8 8 19v9H256 61v-9c0-11 2-15.9 7.8-18.9 3.6-2 6.5-2 187-2.1L443 92zm-23.6 62.7c-.3 2.7-6.3 75.1-13.4 161.1L393.2 472l-2.7 3.6c-5.2 6.8 3.4 6.4-134.5 6.4s-129.3.4-134.5-6.4l-2.7-3.6L106 315.8 92.6 154.7l-.5-4.7H256h163.9l-.5 4.7z"/><use xlink:href="#B"/><use xlink:href="#B" x="90"/><use xlink:href="#B" x="180"/><defs ><path id="B" d="M158.8 182.1c-2.3 1.2-4.6 3.5-5.8 5.9-2 3.9-2 5.7-2 113s0 109.1 2 113c2.3 4.5 8 8 13 8s10.7-3.5 13-8c2-3.9 2-5.7 2-113s0-109.1-2-113c-3.7-7.3-12.7-9.9-20.2-5.9z"/></defs></svg>',j='<svg id="copySVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M248 .6c-10.6 1.9-18.3 5.1-26.6 11-10.1 7.1-16.5 16-22 30.4-4 10.4-9.3 15.7-20.3 19.9-9.5 3.7-14.5 6.6-21.8 12.7l-5.1 4.4h-29.9c-31.2 0-34.2.4-42.9 4.8-9.1 4.7-17.3 16.3-19.4 27.1-1.4 7.3-1.4 361.8 0 369.1 2.9 15.3 15.7 28.1 31 31 7.2 1.4 322.8 1.4 330 0 15.3-2.9 28.1-15.7 31-31 1.4-7.3 1.4-361.8 0-369.1-2.1-10.8-10.3-22.4-19.4-27.1-8.7-4.4-11.7-4.8-43-4.8h-29.9l-5.1-4.3c-7.3-6.2-12.2-9.1-21.7-12.8-11-4.2-16.3-9.5-20.3-19.9-8.1-21.3-20.3-33.2-40.6-39.6-4.7-1.5-19.7-2.6-24-1.8zM268.6 22c11.5 4 20.2 12.6 24.5 24.5 7 19.1 15.5 27.5 34.4 34.4 11.5 4.2 20.6 13.2 24.6 24.5 1.5 4.4 1.9 8.2 1.9 19.1V138h-98-98v-13.5c0-10.9.4-14.7 1.9-19.1 4-11.3 13-20.3 24.5-24.4 18.8-6.8 27.5-15.4 34.5-34.5 7.6-20.7 29.3-31.4 49.7-24.5zM141 98.3c0 .1-.7 3.4-1.5 7.2-1 5-1.5 13.5-1.5 29.7V158h118 118v-22.8c0-16.2-.5-24.7-1.5-29.7l-1.5-7.3c0-.2 10.7-.2 23.8 0l23.9.3 4.8 3c3.2 2 5.6 4.5 7.2 7.4l2.3 4.4-.2 183.2-.3 183.2-2.7 3.6c-1.6 1.9-4.3 4.6-6 5.9l-3.3 2.3H256 91.5l-3.3-2.3c-1.7-1.3-4.4-4-6-5.9l-2.7-3.6-.3-183-.2-183 2.1-4.4c2.4-5 8.1-9.3 13.7-10.4 3.3-.6 46.2-1.2 46.2-.6zm109.3-52.4c-12.7 5.9-10.3 25.1 3.3 27.7 4.7.9 11.8-1.9 14.5-5.8 8.7-12.1-4.3-28.1-17.8-21.9zM138 226.5v9.5h118 118v-9.5-9.5H256 138v9.5zm0 59v9.5h118 118v-9.5-9.5H256 138v9.5zm0 59v9.5h118 118v-9.5-9.5H256 138v9.5zm0 59.5v10h59 59v-10-10h-59-59v10z"/></svg>',F='<svg id="generateSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M356.5 8.4c-1.3 1.3-2.7 4-3 6-.4 2-1.1 3.9-1.7 4.2-.5.3-3.1.1-5.7-.6-4.2-1-5.4-.9-8 .5-3.1 1.6-5.1 4.9-5.1 8.5 0 3.3 4.7 7.7 9.6 8.9 3.7 1 4.5 1.5 3.9 2.9-.3.9-.9 3.8-1.2 6.4-.5 4.3-.3 5 2.5 7.7 5.8 5.9 13 3.1 15.3-6 1.1-4.3 1.6-4.9 3.4-4.4 9.1 2.5 14.5 1.2 16.6-4.2 2.2-5.8-1.8-11-10-12.8-3.2-.7-3.3-.8-2.6-4.4 1.4-6.5 1-10-1.5-12.6-3.2-3.4-9.1-3.5-12.5-.1zM276.6 47c-1.6.5-4 1.9-5.3 3.2-5.3 4.9-5.3 4.8-5.3 46.5v38.9l-30.8 21.7c-17.1 12.1-31.5 23-32.4 24.5-4.2 7-2.4 16.5 3.8 20.9 1.6 1.1 10 4.2 18.7 6.9l15.8 4.8-117.9 118.1C-6.9 462.7 1.5 453.5.3 467.9c-1.9 22.7 17.4 41.9 40 39.8 14.6-1.4 5.9 6.5 135.7-123.3l117.6-117.5 4.8 15.8c2.6 8.7 5.7 17.1 6.8 18.7 4.5 6.3 14.5 8 21.1 3.7 1.5-1 12.6-15.6 24.5-32.5l21.7-30.7 38.8.1c42.4.1 41.9.1 47-5.9 2.9-3.5 4.1-9.3 2.8-13.7-.5-1.7-10.7-16.3-22.8-32.5l-22.5-30.5c-.4-.6 4.7-17 11.3-36.5 10.2-29.9 12-36.1 11.6-40-.7-8.1-7-13.9-15-13.9-1.9 0-18.9 5.2-37.8 11.7L350 92.4c-.8 0-14.9-10-31.3-22.3-16.4-12.2-31.2-22.7-33-23.2-3.7-1.1-5.2-1-9.1.1zm32 38.3c32.4 24.2 34.7 25.7 39.9 25.7 2.9 0 15.1-3.7 37-11.1 17.9-6.1 32.9-10.9 33.2-10.5.3.3-4.4 15.3-10.6 33.3-7.3 21.4-11.1 34.3-11.1 37 0 3.3 1 5.6 4.6 10.9 3.6 5.2 33.2 45.2 38.7 52.2.9 1.2-5 1.3-35.8 1.1-35.7-.4-37.1-.3-40.5 1.7-2.5 1.4-9.2 10.1-24 31.1l-21.1 29.2c-.3.1-5.2-14.9-10.9-33.2-5.6-18.2-11-34.5-11.9-36-.9-1.6-2.9-3.7-4.6-4.7-2.5-1.5-25.7-9-62.7-20.3-3.8-1.1-6.8-2.3-6.7-2.6 0-.3 13.1-9.8 29.2-21.1 21-14.8 29.7-21.5 31.1-24 2-3.4 2.1-4.8 1.7-40.5-.2-30.8-.1-36.7 1.1-35.8.7.5 11.2 8.5 23.4 17.6zm-37.3 138.6c4.9 1.5 9.2 3.2 9.6 3.7s2 5.1 3.6 10.2l2.9 9.3-74.2 74.2-74.2 74.2-13.2-13.3-13.3-13.2 74-74 75-74c.5 0 5 1.3 9.8 2.9zm-184 223.4c-25.7 25.7-40.2 39.5-42.8 40.8-9.4 4.4-20.1.2-24.6-9.6-2.3-4.9-2.4-9.4-.4-14.3 1.1-2.5 14.1-16.2 40.8-42.9L99.5 382l13.2 13.2 13.3 13.3-38.7 38.8zM162.8 73c-1.7 1.3-3.1 4.1-4.3 8.5-2 7.3-2.2 7.3-10 5-6-1.9-9.8-1.2-12.5 2.2-2.3 2.9-2.6 6.4-.8 9.6 1.7 3.2 3.6 4.3 9.6 5.8 3 .7 5.6 1.8 5.9 2.5s-.3 3.8-1.2 6.9c-1.7 6.1-1.4 8.8 1.8 12.2 1.4 1.6 3.2 2.3 5.7 2.3 5.5 0 7.7-2.2 10-10.1 1.9-6.4 2.3-7 4.3-6.5 8.8 2.6 12.9 3 15.4 1.6 5.7-3.2 6-12.6.5-15.4-1.5-.7-5.1-1.9-7.9-2.7-2.9-.7-5.3-1.6-5.3-1.9 0-.4.7-2.9 1.5-5.6 2.3-7.7 2-10.8-1.6-13.8-3.7-3.1-7.7-3.3-11.1-.6zm320.3 48.7c-1.7 1.8-3.2 4.9-4.1 8.6-1.2 5.2-1.6 5.8-3.4 5.2-12.4-3.6-16.7-3-19.1 2.9-2.8 6.8.6 11.1 10.8 13.7 5.3 1.3 5.5 1.8 3.2 9.3-1.7 5.5-1.3 8 1.8 11.3 1.4 1.6 3.2 2.3 5.7 2.3 6.1 0 8.4-2.6 11-12.6l1-4.2 4.7 1.4c2.5.8 6.3 1.4 8.5 1.4 6.7 0 10.5-6.2 7.5-12.6-1.4-2.9-2.6-3.6-8.7-5.5-3.8-1.1-7-2.2-7-2.2 0-.1.7-2.7 1.5-5.7 2.1-7.8 1.9-9.8-1.4-13.1-3.9-3.8-8.3-3.9-12-.2zm-74.3 255.2c-1.3 1.1-3 3.8-3.7 6.1-1.1 3.6-1.5 4-3.4 3.3-4.7-1.7-9.8-.8-12.3 2.1-4.6 5.3-1.9 12.5 5.7 14.7 4.4 1.4 4.3 1.1 2.8 6.3-1.4 5.1.2 9 4.7 11.1 5.8 2.7 10.1.4 12.8-7.1.8-2.4 1.9-3.8 2.7-3.5 5 1.3 9.1 1.2 11.2-.2 6.7-4.4 5-13.9-3-16.5l-4.3-1.4.7-5.8c.5-5.3.4-6-2-8.4-3.2-3.2-8.3-3.5-11.9-.7z"/></svg>',D='<svg id="sendSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M499.5 7.4c-1.6.8-113.7 48.7-249 106.5L2.3 221.6c-2.9 3.2-2.9 6.6 0 9.8 1.2 1.3 33 22.1 70.7 46.1l70.1 45.4c.9.9 10.6 36.7 23.8 87.6l23.3 89.3c1.1 3.8 5.8 6.7 9.4 5.8 1.3-.4 3.6-1.8 5.1-3.2l88.8-81.2c.7-.2 22.9 10.7 49.3 24.2 30.7 15.8 49 24.6 50.9 24.6 1.8 0 3.8-.9 5.1-2.3 1.7-1.8 13.5-48.6 57.8-227.8l55-228.2c-.6-2.6-5-5.7-7.8-5.7-.7.1-2.6.7-4.3 1.4zm-43.5 37c0 .5-304.1 262.2-305.3 262.8-.8.3-124.5-78.3-124.6-79.2-.1-.5 427.5-183.7 429.2-183.9.4-.1.7.1.7.3zm29.4 11.3c-.3 1-22.2 89.9-48.8 197.6l-48.8 196.2c-.5.5-37.3-18.2-111.3-56.3-15.9-8.2-26.9-14.4-26.7-15.2.2-1.1 235.2-324 235.8-324 .1 0 0 .8-.2 1.7zm-36.3 20L336.6 230 229 377.5 213.9 423l-15.2 45.4-18.3-70.4-19.2-73.7-1-3.2 62.7-53.9L453.6 69c.2 0-1.8 3-4.5 6.7zM260 403.3l18 9.4-29.7 27.4-30.9 28.2c-.9.5-.7-1 .6-5l23.6-69.3c.2 0 8.5 4.2 18.4 9.3z"/></svg>';const R='<svg id="exportSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M209.8 39c-2 1.1-4.7 3.6-6 5.7l-2.3 3.8-.3 85.2-.2 85.2-29.8.3c-35 .4-35.7.5-40.4 9.8-3.2 6.1-3.5 10.4-1.3 15.8 1.1 2.5 18.3 20.4 54.8 57.1l58.9 58.1c6.5 5.5 11.2 6.8 17.9 5 3.9-1.1 10.3-7.1 60.7-57.3l58.9-60c3.9-5.7 4.1-11.9.6-18.6-4.8-9.4-5.4-9.5-40.5-9.9l-29.8-.3-.2-85.2-.3-85.2-2.4-3.8c-1.2-2.1-4-4.6-6.2-5.7-3.6-1.9-6-2-46.1-2-39.8.1-42.5.2-46 2zM48.9 330c-4.4 1.3-7.9 4.2-10 8.1-1.8 3.6-1.9 6.2-1.9 47.5 0 36.5.3 44.6 1.6 49.8 4.7 18.4 19.6 33.1 38.4 38.1 8.2 2.2 349.8 2.2 358 0 19.1-5.1 33.4-19.4 38.5-38.5 1.2-4.4 1.5-14.2 1.5-49.3 0-41.6-.1-44-2-47.6-4.9-9.7-19.9-11.9-28.4-4.2-5.5 5.1-5.6 5.5-5.6 49.8 0 37.4-.2 41.1-1.9 44.8-2.2 4.8-4.4 6.9-9.4 9-3.2 1.3-22.7 1.5-171.7 1.5s-168.5-.2-171.7-1.5c-5-2.1-7.2-4.2-9.4-9-1.7-3.7-1.9-7.4-1.9-44.8 0-44.3-.1-44.7-5.6-49.8-4.8-4.4-12-5.9-18.5-3.9z"/></svg>';const J='<svg id="shareSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M411.8 5.1c-20.2 3-37.2 11.4-51.1 25.3-7.6 7.6-12.5 14.8-17.7 25.9-6.1 13.1-7.4 19.2-7.5 35.3v14.2l-88.3 48.1-88.4 48.1-7.1-7.4c-11.7-11.8-24-19.1-40.4-23.8-11.3-3.3-34.3-3.3-45.8 0-31.3 8.9-54.6 32.8-63.1 64.7-2.7 10.3-2.5 32.1.5 43 11.9 44 55.5 72.7 99 65.1 19.9-3.5 33.4-10.3 47.8-24l9.3-8.8 49.8 27 88 47.9 38.2 20.8.4 14.5c.3 16.5 1.8 23 7.7 35.8 5.1 11.1 11.2 19.4 20.2 27.8 12 11.1 26.9 18.8 42.6 22 11.3 2.2 31.5 1.5 41.6-1.5 33.4-9.9 57.9-37.7 63.4-72.1 4.2-25.4-4.5-53.8-22.2-72.6-11.2-12-22.4-19.3-37.2-24.3-32.6-10.9-67.1-2.7-91.2 21.8-6.2 6.3-9.2 10.4-15.6 21.3l-2.2 3.7-85.5-46.5-85.8-46.9c-.1-.1.9-4.2 2.4-9.1 2.4-8 2.7-10.5 2.7-23.9.1-12.6-.3-16.2-2.2-22.5-1.2-4.1-2.3-8.3-2.4-9.3-.2-1.5 17.1-11.3 84.3-47.9l85.6-46.5c.7-.2 2.7 2.2 4.5 5.4 16 28.3 44.7 45.2 77.1 45.3 21.4 0 39-6.3 56.7-20.3 12.9-10.3 24.9-29.2 29.1-46.1 10.7-42.4-12-87.4-52.2-103.5-13.2-5.3-32.4-7.9-45-6zM443 31.9c18.8 6 35 22.2 41.2 41.1 2.9 9 3.5 25.1 1.4 34.5-4.2 18-17.2 34.4-33.6 42.4-11.1 5.4-20.8 7.4-32.6 6.8-26.2-1.5-48.8-18.9-57-44-3.8-11.3-4-27.7-.5-38.2 7.6-23.2 26.8-40.4 50.1-44.9 6.1-1.1 24.6.2 31 2.3zM106 194.6c10.4 3 19 8.3 27.5 16.9 13.3 13.2 18.8 26.4 18.9 45 .1 21.5-10 40.5-28.2 52.9-9.7 6.7-19.3 9.8-31.9 10.4-12.8.6-20.4-.8-30.8-5.7-23.3-10.9-36.8-32.4-36.6-58.1.1-18.1 5.7-31.6 18.6-44.6 10.5-10.5 21.1-16 36.5-18.8 4.7-.9 20.5.3 26 2zm338.2 164.6c18.9 7.1 32.5 20.7 39.6 39.6 3.3 9 4.2 25.5 1.8 35.7-5.2 22-22.7 40.4-45.1 47.1-4.3 1.3-9.3 1.8-17.5 1.8-10 0-12.6-.4-19.5-2.8-20.2-7-34.1-20.9-41.1-41.1-2.4-6.9-2.8-9.5-2.8-19.5 0-19.1 5.2-31.9 18.9-45.5 8.7-8.8 17.9-14.2 29-16.9 9.5-2.4 28.2-1.6 36.7 1.6z"/></svg>',_='<svg id="stopSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M232 1.1c-13.5 1.2-22.5 2.8-38 6.6-51.6 12.5-99.4 42.1-133.7 82.8-17.7 20.9-35.4 51.4-44.8 77C-2 215-4.6 268 8.1 318.2c10.7 42.6 32.7 81.8 64.1 114.4 40.5 41.9 89 67.2 146.9 76.6 11 1.8 17.6 2.2 36.9 2.2 26.8 0 38.6-1.3 62-7 43.3-10.6 83.7-33 116.4-64.4 32.5-31.2 58-75 69.1-118.5 20.3-79.5 3.5-158.9-47.3-224-8.3-10.6-35.4-37.1-46.5-45.4C358.1 13.5 294.6-4.8 232 1.1zm50.5 22c31.2 3.2 69.2 16.2 96 32.9 48 29.9 83.6 75.3 100.9 128.7 7.8 24.3 10.9 44.9 10.8 72.3-.1 51.9-15.8 98.7-47.5 140.8-8.3 11.2-29.8 33.3-40.5 41.6-42.9 33.7-92.1 50.8-146.2 50.8-37.6 0-69.1-7.2-102.5-23.6-48-23.6-84.8-60.4-108-108.1-16.4-33.5-23.6-64.7-23.6-101.8 0-28 3.4-49.6 11.8-74.7C45 147.9 64.2 116.9 90 91c20.1-20.2 38.2-33.2 63.5-45.6 40.1-19.7 82.7-27 129-22.3zM132.2 127.5c-6.6 2.9-6.3-4.4-6 130.5l.3 122 2.8 2.7 2.7 2.8h124 124l2.7-2.8 2.8-2.7.3-122.5c.3-136 .7-127.1-6.3-130.1-5.1-2.1-242.4-2-247.3.1z"/></svg>';function e(e,t){var n=document.createElement("script");n.src=e,n.onload=t,document.head.appendChild(n)}e("https://cdn.jsdelivr.net/npm/marked/marked.min.js",()=>{marked.setOptions({sanitizer:!0,sanitize:!0});var e=localStorage.getItem("copyToFileEnabled");null!==e&&(He=JSON.parse(e),document.getElementById("copyToFileToggle").checked=He),null!==(e=localStorage.getItem("webSearch"))&&(document.querySelector('input[name="webSearch"][value="'+e+'"]').checked=!0),null!==(e=localStorage.getItem("endpoints"))&&(C=JSON.parse(e)),null!==(b=localStorage.getItem("apiKey"))&&(Ee.value=b),C.forEach(t=>{if(t.headers.includes("{"))try{t.headers=t.headers.replace(/'/g,'"');var e,n,o=JSON.parse(t.headers);o.Authorization?(e=o.Authorization.split(" ")[1])&&(t.headers=e):o["x-api-key"]&&(n=o["x-api-key"])&&(t.headers=n)}catch(e){console.error("Error parsing endpoint header:",e),t.headers=""}}),Y(G),(e=(e=new URLSearchParams(window.location.search)).get("gist"))&&fetch("https://api.github.com/gists/"+e).then(e=>e.json()).then(e=>{e.files&&e.files["chat.json"]?(g=JSON.parse(e.files["chat.json"].content),lt()):console.error("No chat data found for this ID.")}).catch(e=>{console.error("Error loading chat:",e)}),P(),S()}),e("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.2/xlsx.full.min.js",()=>{}),e("https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js",()=>{}),e("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js",()=>{var e=document.createElement("script");e.innerHTML='pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js";',document.head.appendChild(e)}),e("https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js",()=>{}),e("https://cdn.jsdelivr.net/npm/epubjs@0.3.88/dist/epub.min.js",()=>{});let G=[];let V=[];function Y(e,t=!1){var n=p.value,o=(p.innerHTML=`<option disabled>Popular models</option>
        <option value='llama-3-70b-chat'>llama-3-70b-chat (Free)</option>
        <option value='dall-e-3'>dall-e-3</option>`,localStorage.getItem("savedModels")),o=(o&&(JSON.parse(o).forEach(t=>{var e=C.find(e=>e.title===t);e&&(e.tested=!0)}),localStorage.removeItem("savedModels"),localStorage.setItem("endpoints",JSON.stringify(C))),C.some(e=>e.tested)&&((o=document.createElement("option")).textContent="Saved endpoints",o.disabled=!0,p.appendChild(o),C.filter(e=>e.tested).sort((e,t)=>e.title.localeCompare(t.title)).forEach(e=>{var t=document.createElement("option"),e=e.title+" - "+e.model;t.value=e,t.textContent=e,p.appendChild(t)})),document.createElement("option")),o=(o.textContent="Image Generation",o.disabled=!0,p.appendChild(o),document.createElement("option")),o=(o.value="dall-e-3",o.textContent="dall-e-3",p.appendChild(o),e.filter(e=>0===e.created)),e=e.filter(e=>0!==e.created),r=document.createElement("option"),r=(r.textContent="Free models",r.disabled=!0,p.appendChild(r),V=[],o.forEach(e=>{V.push(e.id);var t=document.createElement("option");t.value=e.id,t.textContent=e.id+" (Free)",p.appendChild(t)}),document.createElement("option")),o=(r.textContent="Other models",r.disabled=!0,p.appendChild(r),e.forEach(e=>{var t=document.createElement("option");t.value=e.id,t.textContent=e.id,p.appendChild(t)}),t&&Array.from(p.options).map(e=>e.value).includes(n)?p.value=n:p.selectedIndex=1,localStorage.getItem("favoriteModel")||a.value);a.innerHTML=p.innerHTML,Array.from(a.options).map(e=>e.value).includes(o)&&(a.value=o)}{const gt=new AbortController,vt=setTimeout(()=>gt.abort(),2e3);fetch("https://api.discord.rocks/models",{method:"GET",signal:gt.signal}).then(e=>{if(clearTimeout(vt),e.ok)return e.json();console.error("API models returned error status:",e.status),document.getElementById("apiStatusMessage").style.display="block"}).then(e=>{e&&(Y(G=e.data.map(e=>({id:e.id,created:e.created}))),e=localStorage.getItem("favoriteModel"))&&(a.value=e,p.value=e)}).catch(e=>{document.getElementById("apiStatusMessage").style.display="block","AbortError"===e.name?(console.error("Fetch request timed out."),document.getElementById("apiStatusMessage").textContent="Request to api.discord.rocks timed out."):console.error("Error fetching api.discord.rocks data:",e)})}let h=new AbortController;const s=document.getElementById("messageBox"),U=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),l=(s.addEventListener("keydown",function(e){"Enter"!==e.key||U||e.shiftKey||(e.preventDefault(),Ye())}),document.getElementById("fileContainer"));let i=[];function W(e){e.preventDefault(),e.stopPropagation()}function K(e){s.style.border="2px dashed #8f564c"}function Q(e){s.style.border=""}function X(t){for(let e=0;e<t.length;e++){const o=t[e];var n;i.some(e=>e.name===o.name)?alert(`File '${o.name}' is already attached.`):(n=o.name.split(".").pop().toLowerCase(),["xls","xlsx","csv","docx","pdf","pptx","epub","rtf"].includes(n)?(i.push(o),ae(o.name,l),0<l.children.length&&(l.style.display="flex",l.style.marginBottom="10px")):((n=new FileReader).onload=function(e){var t=new Uint8Array(e.target.result),n=new TextDecoder("utf-8",{fatal:!0});try{n.decode(t),i.push(o),ae(o.name,l),0<l.children.length&&(l.style.display="flex",l.style.marginBottom="10px")}catch(e){alert(`File '${o.name}' is not a supported text, rtf, spreadsheet, docx, pptx, pdf or epub file.`),console.error(e)}},n.onerror=function(e){alert(`Failed to read file: ${o.name}.
`+e.message)},n.readAsArrayBuffer(o.slice(0,100))))}}function Z(o){return new Promise((n,t)=>{var e=new FileReader;e.onload=function(e){var e=new Uint8Array(e.target.result),e=XLSX.read(e,{type:"array"}),t=e.SheetNames[0],e=function(e){if(0===e.length)return"";var t=e[0],n=`| ${t.join(" | ")} |
`,t=`| ${t.map(()=>"---").join(" | ")} |
`,e=e.slice(1).map(e=>`| ${e.join(" | ")} |
`).join("");return n+t+e}(XLSX.utils.sheet_to_json(e.Sheets[t],{header:1}));n(e)},e.onerror=function(e){t(new Error(`Failed to read file "${o.name}": `+e.message))},e.readAsArrayBuffer(o)})}function ee(o){return new Promise((t,n)=>{var e=new FileReader;e.onload=function(e){mammoth.extractRawText({arrayBuffer:e.target.result}).then(e=>{t(e.value)}).catch(e=>{n(new Error(`Failed to parse file "${o.name}": `+e.message))})},e.onerror=function(e){n(new Error(`Failed to read file "${o.name}": `+e.message))},e.readAsArrayBuffer(o)})}function te(n){return new Promise((t,o)=>{var e=new FileReader;e.onload=function(e){(new JSZip).loadAsync(e.target.result).then(function(e){const n=[];e.folder("ppt/slides").forEach((e,t)=>{n.push(t.async("string"))}),Promise.all(n).then(e=>{let n="";e.forEach(e=>{var t=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("a:t");for(let e=0;e<t.length;e++)n+=t[e].textContent+"\n"}),t(n.trim())}).catch(e=>{o(new Error("Failed to parse slides: "+e.message))})}).catch(e=>{o(new Error("Failed to load ZIP: "+e.message))})},e.onerror=function(e){o(new Error(`Failed to read file "${n.name}": `+e.message))},e.readAsArrayBuffer(n)})}function ne(i){return new Promise((s,t)=>{var e=new FileReader;e.onload=async function(e){try{var n=e.target.result,o=new Uint8Array(n),r=await pdfjsLib.getDocument({data:o}).promise;let t="";var a=r.numPages;for(let e=1;e<=a;e++){var l=(await(await r.getPage(e)).getTextContent()).items.map(e=>e.str).join("\n");t+=l+"\n\n"}s(t.trim())}catch(e){t(new Error(`Failed to parse file "${i.name}": `+e.message))}},e.onerror=function(e){t(new Error(`Failed to read file "${i.name}": `+e.message))},e.readAsArrayBuffer(i)})}function oe(t){return new Promise((n,o)=>{var e=new FileReader;e.onload=function(e){const t=ePub(e.target.result);t.ready.then(()=>{var e=t.spine.spineItems.map(e=>e.load(t.load.bind(t)).then(()=>e.render()).then(e=>{return(new DOMParser).parseFromString(e,"text/html").body.textContent.trim()}));Promise.all(e).then(e=>{e=e.join("\n\n");n(e)}).catch(e=>{o(new Error("Failed to parse chapters: "+e.message))})}).catch(e=>{o(new Error("Failed to load EPUB: "+e.message))})},e.onerror=function(e){o(new Error(`Failed to read file "${t.name}": `+e.message))},e.readAsArrayBuffer(t)})}function re(e){return e.replace(/\\par[d]?/g,"\n").replace(/\\'[0-9a-f]{2}/gi,e=>String.fromCharCode(parseInt(e.slice(2),16))).replace(/\\[a-z]+\d* ?/gi,"").replace(/[{\\}]/g,"").replace(/\n{2,}/g,"\n")}function ae(n,e,o=null){const r=document.createElement("div");r.classList.add("file-bubble");var t=document.createElement("span"),a=(t.textContent=function(e,t=8){var[n,o]=e.split(".");return n.length<=t?e:n.substring(0,t)+"..."+o}(n),e.classList.value.includes("message-content"));a||((a=document.createElement("button")).classList.add("close-btn"),a.addEventListener("click",e=>{var t;e.stopPropagation(),t=n,e=r,l.removeChild(e),i=i.filter(e=>e.name!==t),B(s),0===i.length&&(l.style.display="none",l.style.marginBottom="0")}),r.appendChild(a)),r.appendChild(t),r.addEventListener("click",()=>{if(o)le(n,o);else{const t=i.find(e=>e.name===n);t&&!function(e){var t=e.name.split(".").pop().toLowerCase();{if(["xls","xlsx","csv"].includes(t))return Z(e);if("docx"===t)return ee(e);if("pdf"===t)return ne(e);if("pptx"===t)return te(e);if("epub"===t)return oe(e);if("rtf"===t){const o=new FileReader;return new Promise((t,n)=>{o.onload=function(e){t(re(e.target.result))},o.onerror=function(e){n(e.message)},o.readAsText(e)})}{const r=new FileReader;return new Promise((t,n)=>{r.onload=function(e){t(e.target.result)},r.onerror=function(e){n(e.message)},r.readAsText(e)})}}}(t).then(e=>{le(t.name,e)}).catch(e=>{console.error(`Failed to open file '${n}': `+e.message)})}}),s.style.maxHeight="calc(30vh - 60px)",e.appendChild(r)}function le(e,t){const n=document.createElement("div");n.classList.add("modal");var o=document.createElement("div"),r=(o.classList.add("modal-content"),document.createElement("div")),a=(r.classList.add("modal-header"),document.createElement("span")),e=(a.textContent=e,document.createElement("span")),a=(e.classList.add("close"),e.addEventListener("click",()=>{document.body.removeChild(n)}),r.appendChild(a),r.appendChild(e),document.createElement("div"));a.classList.add("modal-body"),a.textContent=t,o.appendChild(r),o.appendChild(a),n.appendChild(o),document.body.appendChild(n),n.addEventListener("click",e=>{e.target===n&&document.body.removeChild(n)})}["dragenter","dragover","dragleave","drop"].forEach(e=>{s.addEventListener(e,W,!1)}),["dragenter","dragover"].forEach(e=>{s.addEventListener(e,K,!1)}),["dragleave","drop"].forEach(e=>{s.addEventListener(e,Q,!1)}),s.addEventListener("drop",function(e){e=e.dataTransfer,e=e.files;X(e),B(s)},!1);let se=0;s.addEventListener("paste",function(e){var t=e.clipboardData||window.clipboardData,t=t.getData("Text");t&&1500<t.length&&He&&(e.preventDefault(),e=new Blob([t],{type:"text/plain"}),t=new File([e],`paste-${se}.txt`,{type:"text/plain"}),se++,X([t]),B(s))});const ie=document.getElementById("attachButton"),ce=document.getElementById("fileInput");ie.addEventListener("click",()=>ce.click()),ce.addEventListener("change",e=>{X(e.target.files),B(s),ce.value=""});let de="standard",me="1024x1024";const c=document.getElementById("sendButton"),u=(c.innerHTML=D,document.getElementById("backButton")),d=(u.innerHTML='<svg id="backSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M232.1 1C145.3 9.4 67.7 62 28.4 139.2c-13.9 27.3-22.1 53.6-26.6 85.3-2 14-1.7 50.4.6 66 3.9 27.8 12.1 54.1 24.7 79.4 24.9 50.2 64.7 90 115 115 81.5 40.6 177.9 35 253.9-14.7 29.7-19.4 57.9-48.2 77.1-78.8 7.4-11.6 18.4-34.2 23.4-47.8 5.1-13.8 11-37.6 13.1-53.1 2.3-15.7 2.6-52.1.6-66-4.3-29.9-12-55.4-24.6-81C447.8 66.7 376.6 15 291.5 2.4 279.3.6 244.9-.2 232.1 1zm-10.2 133.3c5.5 3.7 8.9 9.2 10.3 16.6 1 5.2.9 6.9-.6 11.6-1.5 4.9-4.5 8.4-32.3 38.2l-30.7 32.8 116 .5c129.9.6 118.7-.2 125.7 8 9.2 10.8 6.6 26.9-5.7 34.5l-4.9 3-115.4.5-115.3.5 29.1 31c15.9 17 30.1 32.8 31.4 35.1 13.4 22.2-16 45.8-35.1 28.2-2.4-2.2-24.1-25.1-48.1-50.9-50-53.5-49.7-53.2-49.8-66.9 0-14.2-1-13 50.8-68.5l49.1-51.8c7.5-6.3 18.1-7.3 25.5-2.4z"/></svg>',document.getElementById("addButton")),m=(d.innerHTML='<svg id="addSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M237 .6l-13 1.5c-79.1 9-152.2 58.6-192.4 130.5C17 158.8 6.4 191.4 1.9 224c-1.8 12.5-1.8 51.5 0 64C12.4 364.2 53 428.9 116.5 470.6c84 55.2 195.6 55 279.7-.4 126.6-83.5 153.9-257.1 59.1-374.7-40.9-50.7-97.4-82.9-163.3-93C282 1 244.8-.3 237 .6zM276.1 41c16 1.6 31 4.8 47.3 10.1 48.8 16 89.3 48.1 117.1 92.9 23.7 38.3 34.9 87.2 30.4 132.6-6.7 67.8-44.2 127.4-102.9 163.9-38.3 23.7-87.1 34.9-132.6 30.4-85.4-8.4-157.8-66.4-184.3-147.5-14.8-45.2-14.8-89.6 0-134.8 12.3-37.7 35.3-72 64.9-96.9C160.9 53.9 219.3 35.5 276.1 41zM236 191v45h-45-45v20 20h45 45v45 45h20 20v-45-45h45 45v-20-20h-45-45v-45-45h-20-20v45z"/></svg>',document.getElementById("runButton"));m.innerHTML='<svg id="runSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M468.5 1.1c-70.2 4.7-140.4 26-196.5 59.7-16.3 9.7-28.7 18.4-43.7 30.4l-12.1 9.8h-45.9-45.8l-61.8 61.8L1 225.3c0 .4 29 .7 64.5.7l64.5.5c0 .3-1.5 5.6-3.4 11.8-3.4 11.3-7.9 32.2-9.1 42.7l-.6 5.5 54.4 54.4 54.5 54.4 8.3-1.3c12.7-1.8 26.2-4.7 37.9-8.1l12.3-3.6c1.6-.5 1.7 3 1.7 64.1l.8 64.6c.4 0 28.5-27.8 62.5-61.8l61.7-61.7v-46-46.1l6.4-7.6c31.4-37.8 54.5-80.2 71.3-130.6 14.5-43.9 21.5-84.8 23-134.5l.6-22.7-15.9.1c-8.7.1-21.3.5-27.9 1zm20.2 36.1C486 96 469 159.3 442.3 210c-41.6 79-104.2 133.5-177.7 154.6-6.6 1.9-16.2 4.2-21.3 5.1l-9.4 1.7-46.5-46.5-46.5-46.4.6-5.5c.9-7.4 6.6-29.4 10.5-40.5C189.7 126.1 301.4 45.8 437.5 27.1c17.9-2.5 31.9-3.8 43.4-4l8.4-.1-.6 14.2zM192 124.6c0 .3-2.8 3.7-6.2 7.5-14.6 16.3-32.5 42.9-42.4 63.1l-3.8 7.8H97 54.5L94 163.5l39.5-39.5h29.2c16.1 0 29.3.3 29.3.6zM348.5 418L309 457.5V415v-42.5l10.9-5.7c20.8-10.8 46.7-28.5 61.6-42.1l6-5.4.3 29.6.2 29.6-39.5 39.5zm.6-326.9c-17.3 2.9-34.7 15.3-43.5 31.2-13.2 23.6-8.8 54.1 10.6 73.5 11.2 11.3 24.3 17.1 40.3 17.9 18.6 1 33.9-4.9 47-18.1 22.2-22.3 24.3-55.5 5.1-81.4-12.9-17.4-37.1-26.8-59.5-23.1zm26.9 25.5c27 12.6 30.9 49 7.3 67-15.2 11.6-37.8 9.8-51.4-4-20.2-20.5-12.1-54.6 15.4-64.7 8.1-2.9 20.3-2.2 28.7 1.7zM69.7 347.8L35 382.5l8 8 8 8L85.5 364c19-19 34.5-34.9 34.5-35.5 0-1-14-15.5-15-15.5-.3 0-16.1 15.6-35.3 34.8zM87 409.5L35.5 461l7.8 7.7 7.7 7.8 51.7-51.7 51.8-51.8-7.5-7.5c-4.1-4.1-7.7-7.5-8-7.5s-23.7 23.2-52 51.5zm61 17L113.5 461l8 8 8 8 35-35 35-35-7.5-7.5c-4.1-4.1-7.9-7.5-8.5-7.5-.5 0-16.5 15.5-35.5 34.5z"/></svg>';var t=document.getElementById("info-link");const p=document.getElementById("modelDropdown"),ue=document.querySelector(".previous-chats ul");p.addEventListener("change",()=>{var e=p.value,t=document.getElementById("imageQualitySelector"),n=document.getElementById("imageSizeSelector");if("dall-e-3"===e){if(!t){const o=document.createElement("select");o.id="imageQualitySelector",o.innerHTML=`
            <option value="standard">Standard</option>
            <option value="hd">HD</option>
        `,o.value=de,o.addEventListener("change",()=>{de=o.value}),o.selectedIndex=0,document.querySelector(".model-selector-right").appendChild(o)}if(!n){const r=document.createElement("select");r.id="imageSizeSelector",r.innerHTML=`
            <option value="1024x1024">1024x1024</option>
            <option value="1024x1792">1024x1792</option>
            <option value="1792x1024">1792x1024</option>
        `,r.value=me,r.addEventListener("change",()=>{me=r.value}),r.selectedIndex=0,document.querySelector(".model-selector-right").appendChild(r)}}else t&&t.remove(),n&&n.remove()});let g=[],v=-1,pe=!0;function he(){Ye()}function ge(){Ze()}nt(),B(s),d.addEventListener("click",()=>k(s.value.trim())),m.addEventListener("click",function(){document.querySelector(".previous-chats").style.display="none",rt(),Ke(),m.style.display="none",d.style.display="none",c.innerHTML=_,c.removeEventListener("click",he),c.addEventListener("click",ge),u.style.display="block",c.className="abort-button"}),c.addEventListener("click",he),u.addEventListener("click",()=>{c.innerHTML.includes("stop")?Ze().then(setTimeout(ot,0)):ot()}),t.addEventListener("click",function(){confirm("Created by @pianoth, LLMs and domain provided by @meow_18838.\nPowered by the Discord Rocks API (https://api.discord.rocks/).\n\nDo you want to visit the Discord Rocks API website?")&&(window.location.href="https://api.discord.rocks/")});t=document.getElementById("settingsButton");t.innerHTML='<svg id="settingsSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M224.5.9c-5 1.3-11.2 4.9-15.1 8.8-6.5 6.4-8.1 11.7-11.1 35.4-1.4 11.8-3.1 21.9-3.6 22.6s-2.5 1.7-4.5 2.3c-2 .7-8.3 3.2-14 5.7l-10.3 4.6-3.7-3C144.9 63.6 131.8 53.9 128 52c-6.1-3.1-15.9-3.8-23.6-1.5-5.7 1.6-6.7 2.5-29.1 24.8C53 97.7 52.1 98.7 50.5 104.4c-2.3 7.8-1.6 17.5 1.5 23.6 1.3 2.5 7.6 11.2 14 19.5 15.9 20.3 14.8 18 11.3 25-1.7 3.3-4.3 9.4-5.8 13.5s-3.3 8-3.9 8.6-10.8 2.3-22.6 3.8c-23.8 3-28.9 4.6-35.3 11-2.1 2-4.9 6-6.5 8.9l-2.7 5.2v32 32l2.6 5.6c1.5 3.1 4.3 7.3 6.4 9.4 6.6 6.6 12 8.3 34.7 11.1 11.1 1.3 21.2 2.8 22.3 3.3 1.2.5 2.8 3 3.9 6.2 1 3 3.7 9.3 5.9 14.1 2.7 6.1 3.7 9.2 3 10-.5.7-6.4 8.3-13 16.8s-13 17.5-14.3 20c-3.1 6.1-3.8 15.8-1.5 23.6 1.6 5.7 2.5 6.7 24.8 29.1 22.4 22.3 23.4 23.2 29.1 24.8 7.7 2.3 17.5 1.6 23.6-1.5 3.8-1.9 16.9-11.6 34.2-25.3l3.7-3 10.3 4.6c5.7 2.5 12 5 14 5.7 2 .6 4 1.6 4.5 2.3s2.2 10.8 3.6 22.6c3 23.8 4.6 29 11.2 35.6 2.1 2.1 6.3 4.9 9.4 6.4l5.6 2.6H256h31.5l5.6-2.6c3.1-1.5 7.3-4.3 9.4-6.4 6.7-6.7 8.3-12 11.2-35.7 1.4-11.7 3.1-21.8 3.7-22.4s4.5-2.4 8.6-3.9 10.2-4.1 13.5-5.8c7-3.5 4.7-4.6 25 11.3 8.3 6.4 17 12.7 19.5 14 6.1 3.1 15.8 3.8 23.6 1.5 5.7-1.6 6.7-2.5 29.1-24.8 22.3-22.4 23.2-23.4 24.8-29.1 2.3-7.8 1.6-17.5-1.5-23.6-1.8-3.5-11.2-16.2-27.3-36.7-.6-.9.5-4.5 3.6-11.5 2.5-5.7 5-12 5.7-14 .6-2 1.6-4 2.3-4.5s10.8-2.2 22.6-3.6c23.8-3 29-4.6 35.6-11.2 2.1-2.1 4.9-6.3 6.4-9.4l2.6-5.6V256v-31.5l-2.6-5.6c-1.5-3.1-4.3-7.3-6.4-9.4-6.6-6.6-11.9-8.2-35.9-11.4-11.9-1.5-22-3.2-22.5-3.7s-2.1-4.3-3.6-8.4-4.1-10.2-5.8-13.5c-3.5-7-4.6-4.7 11.3-25 6.4-8.3 12.7-17 14-19.5 3.1-6.1 3.8-15.8 1.5-23.6-1.6-5.7-2.5-6.7-24.8-29.1-22.4-22.3-23.4-23.2-29.1-24.8-7.8-2.3-17.5-1.6-23.6 1.5-2.5 1.3-11.2 7.6-19.5 14-20.3 15.9-18 14.8-25 11.3-3.3-1.7-9.4-4.3-13.5-5.8s-8-3.3-8.6-3.9-2.3-10.7-3.7-22.5c-3-23.8-4.6-28.9-11.2-35.6-2.1-2.1-6.3-4.9-9.4-6.4L287.5.5l-30-.2c-16.5-.1-31.3.2-33 .6zm59.4 21.4c5.4 2.7 6.1 4.9 9.6 32.2 2.5 19.8 3.7 26.3 5.1 28.2 1.4 1.8 5.4 3.7 14 6.8 6.6 2.3 16.9 6.6 22.9 9.5 9.5 4.6 11.2 5.1 13.9 4.3 1.7-.5 12.3-8.1 23.6-16.9 27.5-21.4 23.1-21.8 48.7 3.9 25.7 25.6 25.4 21 3.6 49.1-8.9 11.5-16.5 22.3-16.9 23.8-.4 2.3.6 5.3 4.6 13.6 2.9 5.8 7 15.5 9.2 21.5 4.7 13.2 5.2 14.3 8 15.8 1.2.7 13.7 2.7 27.7 4.5 26.9 3.4 29.1 4.1 31.8 9.5 1.8 3.4 1.8 52.4 0 55.8-2.7 5.4-4.9 6.1-31.9 9.5-14 1.9-26.4 3.9-27.6 4.5-2.8 1.5-3.4 2.6-8.1 15.9-2.1 6.1-6.3 15.8-9.1 21.7-4.7 9.5-5.2 11-4.3 13.9.5 1.7 8.1 12.3 16.9 23.6 21.4 27.5 21.8 23.1-3.9 48.7-25.6 25.7-21 25.4-49.1 3.6-11.5-8.9-22.3-16.5-23.8-16.9-2.3-.4-5.3.6-13.6 4.6-5.8 2.9-15.6 7-21.7 9.2-6 2.2-12 4.6-13.2 5.4-3.1 2-3.9 5.7-7.2 32.3-3.1 24.7-3.8 27.1-9.2 29.8-3.4 1.8-52.4 1.8-55.8 0-5.4-2.8-6.1-4.9-9.5-32.1-2.6-20.1-3.7-26.3-5.2-28.3-1.4-1.8-5.3-3.7-13.9-6.8-6.7-2.3-16.9-6.6-22.8-9.4-8.4-4.1-11.3-5.1-13.6-4.6-1.6.3-11.6 7.4-22.2 15.6-10.7 8.3-20.7 15.8-22.2 16.6-5.9 3-7.8 1.7-28.7-19.2-25.3-25.4-25-20.9-3.3-48.9 8.9-11.5 16.5-22.2 16.8-23.7.5-2.1-.6-5.4-4.5-13.4-2.8-5.9-7-15.7-9.1-21.8-2.2-6.2-4.7-12.2-5.5-13.4-2-3.1-5.7-3.9-32.3-7.2-24.7-3.1-27.1-3.8-29.8-9.2-1.8-3.4-1.8-52.4 0-55.8 2.7-5.4 5.1-6.1 29.8-9.2 26.6-3.3 30.3-4.1 32.3-7.2.8-1.2 3.2-7.2 5.4-13.2 2.2-6.1 6.3-15.9 9.2-21.8 4.7-9.6 5.2-11.2 4.3-14-.5-1.8-8.1-12.4-16.9-23.7-21.4-27.5-21.8-23.1 3.9-48.7 25.6-25.7 21.2-25.3 48.7-3.9 11.3 8.8 21.9 16.4 23.6 16.9 2.8.9 4.5.4 14.6-4.6 6.2-3 16-7.1 21.8-9.2 5.8-2 11.5-4.3 12.7-5 3.1-2.1 3.9-5.8 7.2-32.4 3.1-24.7 3.8-27.1 9.2-29.8 1.7-.9 9.6-1.3 27.9-1.3s26.2.4 27.9 1.3zM243.8 150c-36.9 4.6-68.3 27.5-84.3 61.3-19.2 40.7-10.2 89.4 22.3 120.9 32.1 31 79.2 39.2 118.7 20.4 23.8-11.2 40.9-28.3 52-51.9 25.9-54.8.2-119.9-56.8-143.6-14.7-6.1-36.4-9.1-51.9-7.1zm29.2 22.4c22.1 4.7 41.2 17.7 53.9 36.6 9.7 14.5 14.1 29.4 14.1 47.4-.1 28.9-13.7 54.1-38.1 70.5-9.3 6.3-21.7 11.3-32.5 13.2-3.9.7-11.7 1-18.8.7-14.6-.6-26.4-4.1-39.1-11.6-9.5-5.6-22.4-18-28.3-27.2-4.9-7.5-9.8-19.6-11.8-29-1.8-8.4-1.8-25.6 0-34 7.1-33.3 32.8-59.2 66.1-66.5 8-1.8 26.4-1.8 34.5-.1z"/></svg>';const n=document.getElementById("settingsModal");var ve=n.querySelector(".close"),fe=document.getElementById("saveSettingsButton"),ye=document.getElementById("saveSettingsButton2");const Ee=document.getElementById("apiKey"),we=document.getElementById("systemPromptInput"),a=document.getElementById("favoriteModelDropdown"),be=document.getElementById("maxTokensInput"),xe=document.getElementById("temperatureInput"),Ce=document.getElementById("top_pInput");var Se=document.getElementById("endpointsButton");const Le=document.getElementById("endpointsModal");var ke=Le.querySelector(".close");const Ie=document.getElementById("endpointsList");var Me=document.getElementById("addEndpointButton");const f=document.getElementById("endpointSettingsModal");var Be=f.querySelector(".close");const y=document.getElementById("endpointTitle"),E=document.getElementById("endpointUrl"),w=document.getElementById("endpointHeaders"),Te=document.getElementById("toggleApiKeyVisibility"),Ae=document.getElementById("endpointOutput"),ze=document.getElementById("endpointStream"),Ne=document.getElementById("saveEndpointSettingsButton");let b="",Pe=4096,x=1,Oe=1,C=[{title:"OpenAI",url:"https://api.openai.com/v1/chat/completions",headers:"YOUR_API_KEY",model:"gpt-4o",output:"choices[0].delta.content"},{title:"Anthropic",url:"https://api.anthropic.com/v1/messages",headers:"YOUR_API_KEY",model:"claude-3-opus-20240229",output:"delta.text"}],He=(Te.addEventListener("click",()=>{"password"===w.type?(w.type="text",Te.textContent="Hide"):(w.type="password",Te.textContent="Show")}),we.addEventListener("input",function(){B(this)}),xe.addEventListener("input",function(){2<this.value?(alert("Temperature cannot exceed 2."),this.value=2):this.value<0&&(alert("Temperature cannot be less than 0."),this.value=0)}),Ce.addEventListener("input",function(){2<this.value?(alert("Top_p cannot exceed 2."),this.value=2):this.value<0&&(alert("Top_p cannot be less than 0."),this.value=0)}),t.addEventListener("click",function(){be.value=Pe,xe.value=x,Ce.value=Oe,n.style.display=""}),ve.addEventListener("click",function(){n.style.display="none"}),!0);function S(){localStorage.setItem("apiKey",b),localStorage.setItem("copyToFileEnabled",JSON.stringify(He)),localStorage.setItem("webSearch",document.querySelector('input[name="webSearch"]:checked').value),localStorage.setItem("endpoints",JSON.stringify(C)),localStorage.setItem("favoriteModel",a.value)}function $e(){b=Ee.value,He=document.getElementById("copyToFileToggle").checked,S(),Pe=parseInt(be.value)||4096,x=parseFloat(xe.value)||1,Oe=parseFloat(Ce.value)||1,n.style.display="none"}fe.addEventListener("click",$e),ye.addEventListener("click",$e),window.addEventListener("click",function(e){e.target===n&&(n.style.display="none")}),s.addEventListener("input",function(){B(this)});let L=!0;function qe(){Ie.innerHTML="",Array.from(new Set(C.map(e=>e.title+" - "+e.url))).map(e=>e.split(" - ")).forEach(([o,r])=>{var e=document.createElement("li");e.textContent=o,e.addEventListener("click",()=>De(C.findIndex(e=>e.title===o&&e.url===r)));const a=document.createElement("button");a.textContent="Test",a.addEventListener("click",e=>{e.stopPropagation();const t=document.createElement("span"),n=(t.className="loading-spinner",a.appendChild(t),a.disabled=!0,C.filter(e=>e.title===o&&e.url===r));Re(n).then(()=>{alert(`All test requests for endpoint '${o}' were successful!`)}).catch(e=>{var t=n.filter(e=>!e.tested).map(e=>e.model);alert(`Test requests for endpoint '${o}' failed for the following model: `+t.join(", "))}).finally(()=>{a.removeChild(t),a.disabled=!1})});var t=document.createElement("button");t.textContent="Delete",t.addEventListener("click",e=>{e.stopPropagation(),confirm("Are you sure you want to delete this endpoint?")&&(C=C.filter(e=>e.title!==o||e.url!==r),Y(G,!0),S(),qe())}),e.appendChild(a),e.appendChild(t),Ie.appendChild(e)})}Se.addEventListener("click",()=>{qe(),Le.style.display="flex"}),ke.addEventListener("click",()=>{Le.style.display="none"}),Me.addEventListener("click",()=>{C.push({title:"Enter the endpoint title here",url:"Enter the endpoint URL here",headers:"",model:"Enter the model name here",output:"choices[0].message.content",stream:!0}),S(),qe(),De(C.length-1)});const o=document.getElementById("showAdvancedSettingsButton");function je(){o.style.marginBottom="10px",o.textContent="Hide Advanced",document.getElementById("advancedSettings").style.display="",o.removeEventListener("click",je),o.addEventListener("click",Fe)}function Fe(){o.textContent="Show Advanced",o.style.marginBottom="0",document.getElementById("advancedSettings").style.display="none",o.removeEventListener("click",Fe),o.addEventListener("click",je)}function De(l){const r=C[l],a=(y.value=r.title,E.value=r.url,w.value=r.headers,f.querySelector(".model-list"));function t(e,t){const n=document.createElement("li");var o=document.createElement("input");o.type="text",o.value=t;const r=document.createElement("button");r.textContent="Test",r.addEventListener("click",()=>{const e=document.createElement("span");e.className="loading-spinner",r.appendChild(e),r.disabled=!0,Je({...C[l],model:t}).then(([])=>{alert(`Test request for model '${t}' was successful!`)}).catch(e=>{alert(`Test request for model '${t}' failed! `+e.message)}).finally(()=>{r.removeChild(e),r.disabled=!1})});var a=document.createElement("button");a.textContent="Delete",a.addEventListener("click",()=>{e.removeChild(n)}),n.appendChild(o),n.appendChild(r),n.appendChild(a),e.appendChild(n)}a.innerHTML="",C.filter(e=>e.url===r.url).forEach(e=>{t(a,e.model)});var e=document.getElementById("addModelButton");e.hasOwnProperty("_hasClickHandler")||(e.addEventListener("click",function(){t(document.querySelector("#endpointSettingsModal .model-list"),"")}),e._hasClickHandler=!0),Ae.value=r.output,ze.checked=void 0===r.stream||r.stream,f.style.display="flex",Ne.onclick=()=>{var t=a.querySelectorAll("input");const n=Array.from(t).map(e=>e.value.trim());if(n.length!==new Set(n).size)alert("Model names must be unique.");else{let e=C.filter(e=>e.url===r.url);if(r.url!==E.value&&(e.forEach(e=>{C.splice(C.indexOf(e),1)}),0<(e=C.filter(e=>e.url===E.value)).length))alert("Endpoint URL must be unique.");else{e.filter(e=>!n.includes(e.model)).forEach(e=>{C.splice(C.indexOf(e),1)});n.filter(t=>!e.some(e=>e.model===t)).forEach(e=>{C.push({title:y.value,url:E.value,headers:w.value,model:e,output:Ae.value,stream:ze.checked,gemini:!1})}),r.title!==y.value?r.headers!==w.value?C.filter(e=>e.url===E.value).forEach(e=>{e.title=y.value,e.headers=w.value,e.tested=!1}):C.filter(e=>e.url===E.value).forEach(e=>{e.title=y.value}):r.headers!==w.value&&C.filter(e=>e.url===E.value).forEach(e=>{e.headers=w.value,e.tested=!1});t=C.filter(e=>e.url===E.value&&e.title===y.value&&n.includes(e.model)&&!e.tested);if(0<t.length){const o=document.createElement("span");o.className="loading-spinner",Ne.appendChild(o),Ne.disabled=!0,Re(t).then(()=>{alert("All test requests to the endpoint were successful! Models were added to the list of models.")}).catch(e=>{var t=endpointsToTest.filter(e=>!e.tested).map(e=>e.model);alert(`Test requests for endpoint '${title}' failed for the following model: `+t.join(", "))}).finally(()=>{Y(G,!0),S(),qe(),f.style.display="none",Ne.removeChild(o),Ne.disabled=!1})}else Y(G,!0),S(),qe(),f.style.display="none"}}}}function Re(e){return e.reduce((e,o)=>e.then(()=>Je(o).then(([e,t,n])=>{o.url=e,o.output=t,o.gemini=n,o.tested=!0})),Promise.resolve())}function Je(u){let a={},l=(a=u.headers?{Authorization:"Bearer "+u.headers,"x-api-key":u.headers,"Content-Type":"application/json","anthropic-version":"2023-06-01"}:{"Content-Type":"application/json"},{model:u.model,messages:[{role:"user",content:"Hello, world"}],max_tokens:10,stream:u.stream});return u.gemini&&(l={model:u.model,...Ue(l.messages),generation_config:{maxOutputTokens:10}}),l=JSON.stringify(l),new Promise((n,o)=>{function s(d,m){return new Promise((t,n)=>{if(m){var e=d;for(const i of["choices[0].delta.content","content[0].delta.text","choices[0].text","content","delta.content","delta.text","text"])for(const c of e){var o=c.match(/data:\s*({.+?})\s*$/);if(o)try{var r=_e(JSON.parse(o[1]),i);if("string"==typeof r&&""!==r.trim())return t(i)}catch(e){console.error(e)}}n(new Error("Failed to auto-detect output path for streaming response."))}else try{var a=_e(d,u.output);if("string"!=typeof a)throw new Error("Output is not a string: "+typeof a);if(""===a.trim())throw new Error("Output is empty");t(u.output)}catch(e){var l,s,a={"choices[0].message.content":d?.choices?.[0]?.message?.content,"content[0].text":d?.content?.[0]?.text,response:d?.response,text:d?.text,"choices[0].message":d?.choices?.[0]?.message,"candidates[0].content.parts[0].text":d?.candidates?.[0]?.content?.parts?.[0]?.text};for([l,s]of Object.entries(a))if("string"==typeof s)return t(l);n(new Error("Invalid output path: "+e.message))}})}function r(e){if(!e.ok)throw new Error(""+e.statusText);if(u.stream){const a=e.body.getReader(),l=new TextDecoder("utf-8");let o=[],r="";return a.read().then(function e({done:t,value:n}){return t?s(o,!0):(t=l.decode(n,{stream:!0}),r+=t,o=o.concat(r.split("\n\n")),r=o.pop(),a.read().then(e))})}if(e.headers.get("content-type")?.includes("application/json"))return e.json().then(e=>s(e,!1));throw new Error("The response is not JSON")}fetch(u.url.trim(),{method:"POST",headers:a,body:l}).then(r).then(e=>n([u.url.trim(),e,!1])).catch(e=>{const t="https://cloudflare-cors-anywhere.queakchannel42.workers.dev/?"+u.url.trim();fetch(t,{method:"POST",headers:a,body:l}).then(r).then(e=>n([t,e,!1])).catch(e=>{if(u.gemini)return o(e);l=JSON.stringify({model:u.model,...Ue(JSON.parse(l).messages),generation_config:{maxOutputTokens:10}}),fetch(u.url.trim(),{method:"POST",headers:a,body:l}).then(r).then(e=>n([u.url.trim(),e,!0])).catch(e=>{const t="https://cloudflare-cors-anywhere.queakchannel42.workers.dev/?"+u.url.trim();fetch(t,{method:"POST",headers:a,body:l}).then(r).then(e=>n([t,e,!0])).catch(e=>o(e))})})})})}function _e(e,t){return t.replace(/\[(\d+)\]/g,".$1").split(".").reduce((e,t)=>e&&"undefined"!==e[t]?e[t]:void 0,e)}function k(o,a="user"){return new Promise((e,t)=>{if(u.style.display="block",0<i.length){let r="";var n=i.map(o=>new Promise((n,t)=>{var e=o.name.split(".").pop().toLowerCase();["xls","xlsx","csv"].includes(e)?Z(o).then(e=>{r+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"docx"===e?ee(o).then(e=>{e=e.replace(/`/g,"\\`"),r+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"pdf"===e?ne(o).then(e=>{e=e.replace(/`/g,"\\`"),r+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"pptx"===e?te(o).then(e=>{e=e.replace(/`/g,"\\`"),r+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"epub"===e?oe(o).then(e=>{e=e.replace(/`/g,"\\`"),r+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):("rtf"===e?((e=new FileReader).onload=function(e){e=re(e.target.result);r+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()},e.onerror=function(e){t(new Error(`Failed to read file: ${o.name}.
`+e.message))},e):((e=new FileReader).onload=function(e){let t=e.target.result;t=t.replace(/`/g,"\\`"),r+=`
${o.name}
\`\`\`
${t}
\`\`\`
`,n()},e.onerror=function(e){t(new Error(`Failed to read file: ${o.name}.
`+e.message))},e)).readAsText(o)}));Promise.all(n).then(()=>{se=0,o+=r,i=[],l.style.display="none",l.innerHTML="",g.push({role:a,content:o}),s.value="",B(s),document.querySelector(".previous-chats").style.display="none",rt(),A(o,a),z(),e()}).catch(e=>{console.error(e),k("Failed to read attached files.","assistant"),t(e)})}else g.push({role:a,content:o}),s.value="",B(s),document.querySelector(".previous-chats").style.display="none",rt(),A(o,a),z(),e()})}function Ge(e,a){const n=ue.children[ue.children.length-1-a].querySelector('button[title="Generate a new title for the chat."]');if(!n.querySelector(".loading-spinner")){const o=document.createElement("span"),l=(o.className="loading-spinner",n.appendChild(o),new AbortController),s=setTimeout(()=>l.abort(),15e3);new Promise((r,t)=>{fetch("https://llm-playground-backend.uc.r.appspot.com/api/title",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageContent:e}),signal:l.signal}).then(e=>{if(clearTimeout(s),e.ok)return e.json();throw new Error("Failed to fetch chat title: "+e.statusText)}).then(e=>{if(!e.title)throw new Error("Invalid title response");var t,n,o;t=e.title,n=a,o=JSON.parse(localStorage.getItem("chats"))||[],n<o.length?(o[n].title=t,localStorage.setItem("chats",JSON.stringify(o)),N()):console.error("Invalid chat index:",n),r(e.title)}).catch(e=>{n.removeChild(o),"AbortError"===e.name?console.error("Fetch request for the chat title timed out."):console.error("Error fetching chat title:",e),t(e)})})}}function Ve(e,o=!1){return new Promise((t,n)=>{fetch("https://llm-playground-backend.uc.r.appspot.com/api/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageContent:e,auto:o}),signal:h.signal}).then(e=>{if(e.ok)return e.json();throw new Error("Network response was not ok")}).then(e=>{e.searchQuery?t(e.searchQuery):n(new Error("No search string found"))}).catch(e=>{"AbortError"===e.name?n(new Error("Request aborted")):(console.error("Error fetching web search query:",e),n(e))})})}function Ye(){let t=s.value.trim();(t||0<i.length)&&k(t,"user").then(()=>{var e;pe&&(e=JSON.parse(localStorage.getItem("chats"))||[],Ge(t,e.length-1),pe=!1),Ke(),m.style.display="none",d.style.display="none",c.innerHTML=_,c.removeEventListener("click",he),c.addEventListener("click",ge),c.className="abort-button"}).catch(e=>{console.error("Error processing files:",e),k("Failed to read attached files.","assistant")})}function Ue(e){const t={contents:[]};return e.forEach(e=>{e={role:"assistant"===e.role||"system"===e.role?"model":e.role,parts:"system"===e.role?[{text:"<SYSTEM MESSAGE>\n\n"+e.content+"\n\n</SYSTEM MESSAGE>"}]:[{text:e.content}]};t.contents.push(e)}),t}function We(){var e=g[g.length-1].content;if(e){var t=p.value;const o=`{"prompt":"${e}","model":"${t}","n":1,"quality":"${de}","response format":"url","size":"${me}"}`;if(b||V.includes(t)||"dall-e-3"===t){b=b||"missing api key";const r=A("Generating image...","loading");let n=0;L=!0,!function t(){h=new AbortController;var e=new Promise((e,t)=>{setTimeout(()=>{t(new Error("Image generation request timed out."))},12e4)});Promise.race([fetch("https://api.discord.rocks/images/generations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+b.trim()},body:o,signal:h.signal}),e]).then(e=>{if(e.ok)return e.json();throw new Error("Image generation request failed: "+e.error)}).then(e=>{if(u.disabled=!0,!(e.data&&0<e.data.length&&e.data[0].url))throw new Error("Invalid image generation response.");e=e.data[0].url,document.getElementById("messageContainer").removeChild(r),k(e,"assistant"),P(),M(),u.disabled=!1}).catch(e=>{"AbortError"===e.name?L=!1:console.error("Error:",e),n<2&&L?(n++,r.textContent=`Retrying (${n}/2)...`,setTimeout(t,1e3)):(u.disabled=!1,g.pop(),M(),L?(r.textContent="Failed to generate image after multiple retries.",r.className="error-message"):r.parentNode.removeChild(r),z())})}()}else console.log("API key for api.discord.rocks not found. Please obtain an API key from the discord server and enter it in the settings. You will use credit for the API key. WARNING: Do not lose the API key!")}}function Ke(){if("dall-e-3"===p.value)We();else{var e=document.querySelector('input[name="webSearch"]:checked').value;if("on"===e){const t=A("Thinking...","loading");h=new AbortController,Ve(g).then(e=>{Qe(t,e)}).catch(e=>{document.getElementById("messageContainer").removeChild(t),"Request aborted"!==e.message&&I()})}else if("off"===e)I();else{const n=A("Thinking...","loading");h=new AbortController,Ve(g,!0).then(e=>{e?Qe(n,e):(document.getElementById("messageContainer").removeChild(n),I())}).catch(e=>{document.getElementById("messageContainer").removeChild(n),"Request aborted"!==e.message&&I()})}}}function Qe(r,a){var e;r.textContent="Searching for `"+a+"`...",e=a,new Promise((t,n)=>{fetch("https://cloudflare-cors-anywhere.queakchannel42.workers.dev/?https://duckduckgo.com/html/?q="+encodeURIComponent(e),{signal:h.signal}).then(e=>{if(e.ok)return e.text();throw new Error("Network response was not ok")}).then(e=>{var e=(new DOMParser).parseFromString(e,"text/html").querySelectorAll(".result");0<e.length?(e=Array.from(e).slice(0,7).map(e=>{return[e.querySelector(".result__title .result__a").textContent,decodeURIComponent(e.querySelector(".result__title .result__a").href.match(/[?&]uddg=([^&]+)/)[1]),e.querySelector(".result__snippet").textContent]}),t(e)):t("No search results found")}).catch(e=>{"AbortError"===e.name?n(new Error("Search aborted.")):(console.error("Error fetching search results:",e),n(e))})}).then(e=>{var t="This message prompted a DuckDuckGo search query: `"+a+"`. Use these results in your answer. The results are:\n\n"+e.map((e,t)=>`${t+1}. [${e[0]}](${e[1]})\n${e[2]}\n\n`).join("")+`

To quote the results you can use this format: [1].

If you need to quote multiple results, do not group multiple quotes together, but rather quote each result separately, like this: [1], [2].

The links will be automatically filled, you don't have to include them if you use this format.`,n=p.value,o=document.getElementById("systemPromptInput").value.trim(),o={messages:o?[...g.slice(0,-1),{role:"system",content:o},...g.slice(-1),{role:"system",content:t}]:[...g,{role:"system",content:t}],model:n,max_tokens:Pe,temperature:x,top_p:Oe,stream:!0};document.getElementById("messageContainer").removeChild(r),I(o,e.map((e,t)=>`[${t+1}]: `+e[1]).join("\n")+"\n")}).catch(e=>{console.error("Error in search:",e),document.getElementById("messageContainer").removeChild(r),"Search aborted."!==e.message&&I()})}function I(t=null,r=null){const n=p.value;var a=document.getElementById("systemPromptInput").value.trim(),t=t||{messages:a?[...g.slice(0,-1),{role:"system",content:a},...g.slice(-1)]:g,model:n,max_tokens:Pe,temperature:x,top_p:Oe,stream:!0},a=C.find(e=>e.title+" - "+e.model===n);if(a){let e={};if(e=a.headers?{Authorization:"Bearer "+a.headers,"x-api-key":a.headers,"Content-Type":"application/json","anthropic-version":"2023-06-01"}:{"Content-Type":"application/json"},t.model=a.model,a.stream)Xe(t,r,a.url,e,a.output,a.gemini);else{delete t.stream;{var[l,a,s,i,c,d=!1]=[t,r,a.url,e,a.output,a.gemini];d&&(l={model:l.model,...Ue(l.messages),generation_config:{temperature:x,topP:l.top_p,maxOutputTokens:l.max_tokens}});const m=A("Loading...","loading");let n=0,o=a||"";!function t(){h=new AbortController,fetch(s,{method:"POST",headers:i,body:JSON.stringify(l),signal:h.signal}).then(e=>{if(e.ok)return e.json();throw new Error(`Request to ${s} failed: `+e.statusText)}).then(e=>{if(u.disabled=!0,"string"!=typeof(e=_e(e,c)))throw new Error("Output is not a string: "+typeof e);o+=e,document.getElementById("messageContainer").removeChild(m),A((o=""===o.trim()?"No response from the API.":o).trim(),"assistant"),g.push({role:"assistant",content:o.trim()}),z(),P(),M(),u.disabled=!1}).catch(e=>{"AbortError"===e.name?L=!1:console.error("Error:",e),n<2&&L?(n++,m.textContent=`Retrying (${n}/2)...`,setTimeout(t,1e3)):(u.disabled=!1,g.pop(),M(),L?(m.textContent="Failed to load response after multiple retries.",m.className="error-message"):(m.parentNode.removeChild(m),o.trim()&&k(o.trim(),"assistant")),z())})}()}}}else b||V.includes(n)||alert("API key for api.discord.rocks not found. Please obtain an API key from the discord server and enter it in the settings. You will use credit for the API key. WARNING: Do not lose the API key!"),Xe(t,r,"https://api.discord.rocks/chat/completions",{"Content-Type":"application/json",Authorization:"Bearer "+(b=b||"missing api key").trim()},"choices[0].delta.content")}function Xe(e,t,n,o,s,r=!1){r&&(e={model:e.model,...Ue(e.messages),generation_config:{temperature:x,topP:e.top_p,maxOutputTokens:e.max_tokens}});const i=A("Loading...","loading");let a=0;let c=t||"",d="";!function t(){h=new AbortController,fetch(n,{method:"POST",headers:o,body:JSON.stringify(e),signal:h.signal}).then(e=>{if(!e.ok)throw new Error(`Request to ${n} failed: `+e.statusText);const o=e.body.getReader(),r=new TextDecoder("utf-8"),a=(i.innerHTML="",document.createElement("span"));function l(e){"AbortError"===e.name?(document.getElementById("messageContainer").removeChild(i),g.pop(),c.trim()&&(k(c.trim(),"assistant"),z(),P())):(console.error("Error:",e),z())}a.classList.add("message-content"),i.appendChild(a),o.read().then(function e({done:t,value:n}){t?(u.disabled=!0,document.getElementById("messageContainer").removeChild(i),A((c=""===c.trim()?"No response from the API.":c).trim(),"assistant"),g.push({role:"assistant",content:c.trim()}),z(),P(),M(),u.disabled=!1):(t=r.decode(n,{stream:!0}),n=(d+=t).split("\n\n"),d=n.pop(),n.forEach(t=>{try{var e,n,o=t.match(/data:\s*({.+?})\s*$/);o&&"[DONE]"!==(e=o[1])&&(n=_e(JSON.parse(e),s))&&(c+=n,et(a,c),i.className="assistant-message")}catch(e){console.error("Failed to parse event:",e,"Event:",t)}}),o.read().then(e).catch(l))}).catch(l)}).catch(e=>{"AbortError"===e.name?L=!1:console.error("Error:",e),a<2&&L?(a++,i.textContent=`Retrying (${a}/2)...`,setTimeout(t,1e3)):(u.disabled=!1,g.pop(),M(),L?(i.textContent="Failed to load response after multiple retries.",i.className="error-message"):(i.parentNode.removeChild(i),c.trim()&&k(c.trim(),"assistant")),z())})}()}function M(){c.innerHTML=D,d.style.display="",m.style.display="",c.removeEventListener("click",ge),c.addEventListener("click",he),c.className=""}function Ze(){return new Promise(e=>{z(),g.push(g.slice(-1)[0]),h.abort(),h=new AbortController,M(),u.disabled=!1,e()})}function B(e){e.style.height="51px",e.style.paddingTop="17.6px",e.style.height=e.scrollHeight+"px";var t=0<i.length?"calc(30vh - 60px)":"30vh";e.style.maxHeight=t,document.getElementById("messageBoxContainer").contains(e)&&(e.style.paddingLeft=ie.offsetWidth+15+"px")}function et(e,n){if(r=n,/\\[a-zA-Z([]+/.test(r)){r=/\\\[[\s\S]*?\\\]/g;let a=0;const l=[],s=[];var o=(e,t,n,o)=>{var r=`$$$$$MATH$${a++}$$$$$`;return l.push({match:e,placeholder:r}),r};n=(n=n.replace(/\\\(.*?\\\)/g,o)).replace(r,o),l.forEach(e=>{try{var t=katex.renderToString(e.match.slice(2,-2),{throwOnError:!1,displayMode:e.match.startsWith("\\[")});s.push({placeholder:e.placeholder,html:t})}catch(e){console.error("KaTeX rendering error:",e)}});let t=marked.parse(n);s.forEach(e=>{t=t.replace(e.placeholder,e.html)}),e.innerHTML=t.replace(/(?<!<\/?\w+>)\n(?!\s*<\/?\w+>)/g,"<br>")}else{if(r=n,!/[#*_\[\]`!]/.test(r))return void(e.innerHTML=n.replace(/\n/g,"<br>"));e.innerHTML=marked.parse(n).replace(/(?<!<\/?\w+>)\n(?!\s*<\/?\w+>)/g,"<br>")}var r;e.querySelectorAll("pre").forEach(t=>{var e=document.createElement("button");e.textContent="Copy Code",e.className="copy-code-button",e.onclick=function(){var e=t.innerText.slice(0,-11);navigator.clipboard.writeText(e).then(()=>alert("Code copied to clipboard!")).catch(e=>console.error("Failed to copy code: ",e))},t.appendChild(e)})}function T(e,t,n=!0,o){if(/\n[^\n]+\.\w+\n```\n([\s\S]*?)\n```/g.test(t)&&n){var r,a=e,l=t,s=/\n[^\n]+\.\w+\n```\n([\s\S]*?)\n```/g,n=(a.innerHTML="",l.replace(s,""));for(n.trim()&&(et(r=document.createElement("span"),n.trim()),a.appendChild(r));null!==(c=s.exec(l));){var i=c[0].match(/\n[^\n]+\.\w+/)[0].trim(),c=c[1].trim();ae(i,a,c)}}else if(t.startsWith("https://dalleprodaue.blob.core.windows.net/private/images/")){var d=t;var m=o;m.className="image-message";let e=m.querySelector("img");e||((e=document.createElement("img")).classList.add("dalle-image"),m.appendChild(e));e.dataset.latestUrl=d,e.onload=()=>{e.dataset.latestUrl===d&&m.scrollIntoView({behavior:"smooth",block:"end"})},e.src=d,e.onclick=()=>window.open(d,"_blank")}else et(e,t)}function tt(l,s,i,c,d,m,e,u){var t=1e3+function(e){var t,n=/^\[\d+\]:\s+https?:\/\/\S+\s*/gm;let o=0;for(;null!==(t=n.exec(e));)o+=t[0].length;return o}(e);const p="user-message"===m.className;if(e.length>t){const n=e.substring(0,t)+"...",o=(T(d,n,p,m),document.createElement("button"));o.textContent="Show More",o.className="show-more-button",o.title="Show the full content of this message.",o.setAttribute("aria-describedby","showMoreButtonDesc"),m.appendChild(o),o.onclick=function(){"Show More"===o.textContent?(T(d,e,p,m),o.textContent="Show Less",o.title="Collapse the content of this message.",o.setAttribute("aria-describedby","showLessButtonDesc")):(T(d,n,p,m),o.textContent="Show More",o.title="Show the full content of this message.",o.setAttribute("aria-describedby","showMoreButtonDesc"))}}else T(d,e,p,m);c.addEventListener("change",()=>{var e=c.value,t=parseInt(m.id.split("-")[1]);-1!==t&&(h.abort(),h=new AbortController,g[t].role=e,z(),m.className=e+"-message")}),l.onclick=function(){L=!1,h.abort();let t=parseInt(m.id.split("-")[1]);if(-1!==t){const r=document.createElement("textarea");r.style.width="100%",r.value=g[t].content,setTimeout(()=>{B(r)},0),r.addEventListener("input",function(){B(this)});var n=document.createElement("button"),o=(n.innerHTML='<svg id="confirmSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M234 13.6c-1.9.2-8.2 1.1-14 2-97.3 14.5-177.1 87.6-200.3 183.5-5.2 21.1-6.2 30.7-6.2 56.9 0 31.2 2.4 47.3 11.1 74.2 24.1 74.7 82.5 133 157.2 157.2 27.3 8.8 43 11.1 75.2 11 22.9-.1 27-.3 40-2.7 51.7-9.3 97.5-33.5 133-70.3 36.2-37.4 57.9-81.1 66.7-133.9 2.5-15.6 2.5-55.4 0-71-9.3-56-33.5-102.3-73.4-140.5-29-27.8-64.1-47.7-102.8-58.4-21.8-6-35-7.8-60.5-8.1-12.4-.2-24.1-.1-26 .1zM275.1 58c72.8 7.4 135.7 53.6 163.9 120.4 10.9 25.7 15.4 48.4 15.4 77.6 0 29.4-4.6 52.5-15.6 78.1-40.3 93.7-144.1 141.8-241.4 111.9-72.3-22.2-125.5-83.7-138-159.6-2.5-15.1-2.5-45.7 0-60.8 7-42.4 26.3-80.3 56.1-110.1 42-42 101.3-63.4 159.6-57.5zm90.4 98.5L361 158c-.2 0-33.2 32.7-73.2 72.7L215 303.5l-31.8-31.7c-17.4-17.4-33.3-32.4-35.2-33.4-2.1-1-5.7-1.7-9-1.7-15.9 0-26.7 16.6-20.1 30.8 1.3 2.7 15.7 17.7 43.7 45.6 44.5 44.1 44.2 43.9 53.5 43.9 8.6 0 9.3-.6 95-86.6 87.7-88.1 83.9-83.8 83.9-94-.1-7.2-5.2-15.4-12-18.9-4.6-2.4-12.7-2.8-17.5-1z"/></svg>',n.className="confirm-button",n.title="Confirm the changes.",n.setAttribute("aria-describedby","confirmButtonDesc"),document.createElement("button"));o.innerHTML=H,o.className="cancel-button",o.title="Cancel the changes.",o.setAttribute("aria-describedby","cancelButtonDesc"),m.replaceChild(r,d),u.innerHTML="";const a=m.querySelector(".show-more-button");let e=null!==a;e&&m.removeChild(a),u.appendChild(n),u.appendChild(o),n.onclick=function(){g[t]?g[t].content=r.value:g.push({role:"user",content:r.value}),T(d,r.value,p,m),m.replaceChild(d,r),u.innerHTML="",u.appendChild(l),u.appendChild(s),u.appendChild(i),u.appendChild(c),z(),tt(l,s,i,c,d,m,r.value,u)},o.onclick=function(){m.replaceChild(d,r),u.innerHTML="",u.appendChild(l),u.appendChild(s),u.appendChild(i),u.appendChild(c),e&&m.appendChild(a)}}},s.onclick=function(){if(confirm("Are you sure you want to delete this message?")){h.abort();var e=parseInt(m.id.split("-")[1]);if(-1!==e){document.getElementById("messageContainer").removeChild(m),g.splice(e,1),z();var t=document.getElementById("messageContainer").children;for(let e=0;e<t.length;e++)t[e].setAttribute("id","message-"+e);P()}}},i.onclick=function(){navigator.clipboard.writeText(e).then(()=>alert("Message copied to clipboard!")).catch(e=>console.error("Failed to copy text: ",e))}}function A(e,n){const t=document.createElement("div");e.trim().startsWith("[")&&((o=document.createElement("div")).classList.add("info-bubble"),o.textContent="Quotes hidden.",t.appendChild(o)),t.classList.add("messageDiv"),t.setAttribute("id","message-"+document.getElementById("messageContainer").children.length),t.style.flexDirection="column",t.style.alignItems="center";var o=document.createElement("span"),r=(o.classList.add("message-content"),t.appendChild(o),document.createElement("div")),a=(r.className="message-buttons",document.createElement("button")),l=(a.innerHTML=$,a.className="edit-button",a.title="Edit this message.",a.setAttribute("aria-describedby","editButtonDesc"),document.createElement("button"));l.innerHTML=j,l.className="copy-button",l.title="Copy this message to the clipboard.",l.setAttribute("aria-describedby","copyButtonDesc");const s=document.createElement("select");s.className="role-selector",s.title="Change the role of this message.",s.setAttribute("aria-describedby","roleSelectDesc");["user","assistant","system"].forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e.charAt(0).toUpperCase()+e.slice(1),e===n&&(t.selected=!0),s.appendChild(t)});var i,c=document.createElement("button");return c.innerHTML=q,c.className="delete-button",c.title="Delete this message.",c.setAttribute("aria-describedby","deleteButtonDesc"),r.appendChild(a),r.appendChild(l),r.appendChild(s),r.appendChild(c),t.className="user"===n?"user-message":"assistant"===n?"assistant-message":"system"===n?"system-message":"loading"===n?"loading-message":"error-message",document.getElementById("messageContainer").appendChild(t),setTimeout(()=>{t.getBoundingClientRect(),t.scrollIntoView({behavior:"smooth",block:"center"})},0),"loading"!==n?(T(o,e,"user"===n,t),(i=t.querySelector("img.dalle-image"))?t.insertBefore(r,i):t.appendChild(r),tt(a,c,l,s,o,t,e,r)):o.textContent=e,t}function z(){var e,t=JSON.parse(localStorage.getItem("chats"))||[];-1===v||v>=t.length?(e={timestamp:(new Date).toISOString(),title:"Chat on "+(new Date).toLocaleString(),conversation:g},t.push(e),v=t.length-1):t[v].conversation=g,localStorage.setItem("chats",JSON.stringify(t)),N()}function nt(){var t=JSON.parse(localStorage.getItem("chats"))||[];ue.innerHTML="";for(let e=t.length-1;0<=e;e--)!function(t,o){var e=document.createElement("li"),n=(e.textContent=""+(t.title||"Untitled"),document.createElement("button")),r=(n.style.marginTop="5px",n.style.marginLeft="5px",n.innerHTML=$,n.title="Edit the title of the chat.",n.setAttribute("aria-describedby","editTitleButtonDesc"),n.onclick=function(e){e.stopPropagation();var t,e=o,n=prompt("Enter new title for the chat:");n&&(t=JSON.parse(localStorage.getItem("chats")))&&t.length>e&&(t[e].title=n,localStorage.setItem("chats",JSON.stringify(t)),N())},document.createElement("button")),a=(r.innerHTML=F,r.title="Generate a new title for the chat.",r.setAttribute("aria-describedby","generateTitleButtonDesc"),r.onclick=function(e){e.stopPropagation(),Ge(t.conversation.map(e=>e.content).join("\n"),o)},document.createElement("button")),l=(a.innerHTML=q,a.title="Delete the chat.",a.setAttribute("aria-describedby","deleteChatButtonDesc"),a.onclick=function(e){e.stopPropagation();var t,e=o;confirm("Are you sure you want to delete this chat?")&&(t=JSON.parse(localStorage.getItem("chats")))&&t.length>e&&(t.splice(e,1),localStorage.setItem("chats",JSON.stringify(t)),setTimeout(P(),0),N())},document.createElement("div"));e.appendChild(l),l.appendChild(n),l.appendChild(r),l.appendChild(a),e.style.display="flex",e.style.flexWrap="wrap",e.style.alignItems="center",e.onclick=()=>{var e=o;if(pe=!1,(t=JSON.parse(localStorage.getItem("chats")))&&t.length>e){var t=t[e],n=(g=t.conversation,v=e,document.getElementById("messageContainer").innerHTML="",g.forEach(e=>{A(e.content,e.role)}),document.getElementById("messageContainer").children);for(let e=0;e<n.length;e++)n[e].setAttribute("id","message-"+e);u.style.display="block",document.querySelector(".previous-chats").style.display="none",rt(),c.innerHTML=D,d.style.display="",m.style.display="",B(s)}},ue.appendChild(e)}(t[e],e)}function N(){ue.innerHTML="",nt()}function ot(){z(),document.getElementById("messageContainer").innerHTML="",document.querySelector(".export-button-container").innerHTML="",g=[],v=-1,u.style.display="none",document.querySelector(".message-form").style.flex="1",document.querySelector(".previous-chats").style.display="block",c.innerHTML=D,d.style.display="",m.style.display="",B(s),pe=!0,P(),setTimeout(()=>{document.documentElement.scrollIntoView({behavior:"smooth",block:"start"})},0)}function rt(){var e=document.querySelector(".export-button-container");if(!e.querySelector("#exportChatButton")||!e.querySelector("#shareChatButton")){const t=document.createElement("button"),n=(t.innerHTML=R,t.title="Export the current chat as a text file.",t.setAttribute("aria-describedby","exportChatDesc"),t.id="exportChatButton",e.appendChild(t),document.createElement("button"));n.innerHTML=J,n.title="Create a shareable link to the current chat.",n.setAttribute("aria-describedby","shareChatDesc"),n.id="shareChatButton",e.appendChild(n)}const t=document.getElementById("exportChatButton"),n=document.getElementById("shareChatButton");e.appendChild(r),r.style.display="",P(),t.onclick=function(){const e=JSON.parse(localStorage.getItem("chats"))[v],t=document.createElement("div");function n(e,t){var n=JSON.parse(localStorage.getItem("chats"))[v],e=new Blob([e],{type:"json"===t?"application/json":"text/plain"}),e=URL.createObjectURL(e),o=document.createElement("a");o.href=e,o.download=`${n.title||"Untitled"}.`+t,o.click(),URL.revokeObjectURL(e)}t.innerHTML=`
                <div id="formatModal" class="modal">
                    <div class="modal-content" style="text-align: center;">
                        <div class='modal-header'>
                            <span></span>
                            <span class='close'></span>
                        </div>
                        <h3>Choose Export Format:</h3>
                        <button id="formatTextBtn">Formatted Text</button>
                        <button id="formatJSONBtn">JSON</button>
                    </div>
                </div>
            `,document.body.appendChild(t),document.getElementById("formatModal").querySelector(".close").addEventListener("click",function(){t.remove()}),window.addEventListener("click",function(e){e.target===document.getElementById("formatModal")&&t.remove()}),t.querySelector("#formatTextBtn").onclick=()=>{n(function(e){var n=JSON.parse(localStorage.getItem("chats"));if(n&&n.length>e){n=n[e];let t="";return n.conversation.forEach(e=>{t+=`*${e.role}* : ${e.content}

---

`}),t.substring(0,t.length-7)}}(v),"txt"),t.remove()},t.querySelector("#formatJSONBtn").onclick=()=>{n(JSON.stringify(e.conversation),"json"),t.remove()}},n.onclick=function(){var e;confirm("Warning: Do not share sensitive data. The only way to un-share the chat is to contact @pianoth and sending the chat link to be removed.\n\nDo you want to create a public link for this chat?")&&(e=g,fetch("https://llm-playground-backend.uc.r.appspot.com/api/gist",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",content:JSON.stringify(e)})}).then(e=>e.json()).then(e=>{var t;e.id?(t=""+window.location.origin+window.location.pathname+"?gist="+e.id,confirm("Shareable link created: "+t+"\n\nDo you want to copy the URL to the clipboard?")&&navigator.clipboard.writeText(t).then(()=>alert("Link copied to clipboard.")).catch(e=>console.error("Failed to copy link: ",e))):console.error("Failed to save chat data:",e)}).catch(e=>{console.error("Error:",e)}))}}o.addEventListener("click",je),Be.addEventListener("click",()=>{f.style.display="none"});const r=document.createElement("div"),at=(r.classList.add("message-counter"),r.textContent="Messages: 0",r.style.display="none",document.createElement("div"));function P(){var e=g.length;r.textContent="Messages: "+e;let t=0;(JSON.parse(localStorage.getItem("chats"))||[]).forEach(e=>{t+=e.conversation.length}),at.textContent="Total Messages: "+t}function lt(){document.getElementById("messageContainer").innerHTML="",g.forEach(e=>{A(e.content,e.role)}),u.style.display="block",document.querySelector(".previous-chats").style.display="none",c.innerHTML=D,d.style.display="",m.style.display="",z(),rt()}at.classList.add("global-message-counter");at.style.zIndex="998",at.textContent="Total Messages: 0",document.querySelector(".previous-chats").appendChild(at);const O=document.createElement("textarea"),st=(O.id="searchTextarea",O.placeholder="Search chats...",document.querySelector(".previous-chats-controls").appendChild(O),document.getElementById("searchButton")),it=(st.innerHTML='<svg id="searchSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M181.7 1.6C108.2 10.5 43.3 60.3 15.3 129.4-12 197-2 273.3 41.9 332c7 9.4 24.4 27.4 33.7 35.1 37.4 30.6 83 46.9 131.1 46.9 41.9 0 79.3-11 114.2-33.7l8.4-5.5 64.6 64.5c44.1 44.1 66 65.2 69.1 66.8 3.8 2 6 2.4 14 2.4 11.2 0 16.6-2.1 23.2-9.3 6.1-6.7 8.3-12.2 8.3-21.7 0-14.1 2.7-10.9-69.8-83.4l-64.5-64.4 4-5.6c13.4-19.1 25-45.5 30.8-70.5 7.2-30.4 6.6-68.2-1.5-99-13.3-50.7-46.8-95.9-91.7-123.8C276.7 6.6 228.3-4 181.7 1.6zM236 66.5c18.2 4 35.8 11.5 51.1 21.6 10.8 7.3 26.7 22.3 34.3 32.3 28.4 37.8 36.7 86.6 22.1 131.2-11.9 36.5-37.7 66.4-72 83.6-39.3 19.8-84 20.5-124.3 2.2-16.3-7.4-30.4-17.6-43.8-31.7C84.5 286 72.2 262.4 66.3 235c-2.6-12.2-2.6-44 .1-55.9 6.2-28.7 19.4-52.9 39.6-73.1 22.1-22.1 49.7-36.1 80.5-40.9 9.1-1.5 40.6-.5 49.5 1.4z"/></svg>',document.getElementById("exportDataButton")),ct=(it.innerHTML=R,document.getElementById("importDataButton")),dt=(ct.innerHTML='<svg id="importDataSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M247.5 38.9c-1.6 1-29 27.9-60.7 59.7-63.6 63.9-60.6 60.2-57.9 70.4 1.5 5.6 3.8 8.9 8.2 11.5 3.2 1.9 5.5 2 33.7 2.3l30.2.3v83.2l1.1 87.2c1.4 5 6.4 10 11.4 11.4 5.5 1.5 79.5 1.5 85 0 5-1.4 10-6.4 11.4-11.4.7-2.8 1.1-29.9 1.1-87.2v-83.2l30.3-.3c28.1-.3 30.4-.4 33.6-2.3 4.4-2.6 6.7-5.9 8.2-11.5 2.7-10.2 5.8-6.5-58.4-70.8l-60.9-59.8c-3.9-2-12.7-1.8-16.3.5zM48.9 330c-4.4 1.3-7.9 4.2-10 8.1-1.8 3.6-1.9 6.2-1.9 47.5 0 36.5.3 44.6 1.6 49.8 4.7 18.4 19.6 33.1 38.4 38.1 8.2 2.2 349.8 2.2 358 0 19.1-5.1 33.4-19.4 38.5-38.5 1.2-4.4 1.5-14.2 1.5-49.3 0-41.6-.1-44-2-47.6-4.9-9.7-19.9-11.9-28.4-4.2-5.5 5.1-5.6 5.5-5.6 49.8 0 37.4-.2 41.1-1.9 44.8-2.2 4.8-4.4 6.9-9.4 9-3.2 1.3-22.7 1.5-171.7 1.5s-168.5-.2-171.7-1.5c-5-2.1-7.2-4.2-9.4-9-1.7-3.7-1.9-7.4-1.9-44.8 0-44.3-.1-44.7-5.6-49.8-4.8-4.4-12-5.9-18.5-3.9z"/></svg>',document.getElementById("deleteDataButton")),mt=(dt.innerHTML='<svg id="deleteDataSVG" xmlns="http://www.w3.org/2000/svg" width="682.667" height="682.667" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M68.3 33.5c-8.5 2.3-15.3 6.3-21.9 12.9-6.7 6.7-10.6 13.4-12.9 22.3-2.2 8.6-2.2 238 0 246.6 2.3 8.9 6.2 15.6 12.9 22.3C56.8 348 67.6 352 85.8 352H96v10.8c0 17.8 3.9 28.3 14.4 38.8 10.4 10.4 21.2 14.4 39.4 14.4H160v10.8c0 17.8 3.9 28.3 14.4 38.8 3.4 3.4 8.5 7.3 11.4 8.8 11.3 5.7 7.5 5.6 133.8 5.6l121.5-1c18.3-3.5 34.4-19.6 37.9-37.9 1.4-7.4 1.4-234.8 0-242.2-2.5-12.9-12.5-26.7-23.8-32.7-8.6-4.6-16-6.2-28.4-6.2H416v-9.9c0-17.9-3.5-28.2-13.3-38.7-10.1-10.9-21.8-15.4-39.9-15.4H352v-9.9c0-5.4-.5-12.2-1-15.2-2.5-12.9-12.5-26.7-23.8-32.7-12.2-6.5-5.7-6.2-135.7-6.1L68.3 33.5zm244.3 33.1c6 4.4 6.9 6.7 7.2 18.5l.4 10.9h-90.9c-98.8 0-96.2-.1-107.5 5.6-6.7 3.4-16.8 13.5-20.2 20.2-5.7 11.3-5.6 8.7-5.6 107.5v90.9l-10.9-.4c-11.8-.3-14.1-1.2-18.5-7.2-2.1-2.7-2.1-3.4-2.4-117.9l.3-118.4c.7-4 4.9-9.1 9-10.9 2.4-1.1 24.2-1.3 119.7-1.1 116.1.2 116.7.2 119.4 2.3zm64 64c6 4.4 6.9 6.7 7.2 18.5l.4 10.9h-90.9c-98.8 0-96.2-.1-107.5 5.6-6.7 3.4-16.8 13.5-20.2 20.2-5.7 11.3-5.6 8.7-5.6 107.5v90.9l-10.9-.4c-11.8-.3-14.1-1.2-18.5-7.2-2.1-2.7-2.1-3.4-2.4-117.9l.3-118.4c.7-4 4.9-9.1 9-10.9 2.4-1.1 24.2-1.3 119.7-1.1 116.1.2 116.7.2 119.4 2.3zm64 64c1.5 1.1 3.7 3.3 4.8 4.8 2.1 2.7 2.1 3.1 2.1 120.6s0 117.9-2.1 120.6c-1.1 1.5-3.3 3.7-4.8 4.8-2.7 2.1-3.1 2.1-120.6 2.1s-117.9 0-120.6-2.1c-1.5-1.1-3.7-3.3-4.8-4.8-2.1-2.7-2.1-3.4-2.4-117.9l.3-118.4c.7-4 4.9-9.1 9-10.9 2.4-1.1 24.2-1.3 119.7-1.1 116.1.2 116.7.2 119.4 2.3zm-181.9 53.8c-4.5 1.7-7.4 4-9.4 8-1.8 3.4-1.9 10.5-.3 13.8.7 1.2 11.8 13 24.8 26l23.7 23.8-23.7 23.7c-13 13.1-24.1 24.9-24.8 26.1-2.6 5.3-.8 14.4 3.6 18.3 4.7 4.1 12.6 5.4 17.6 2.9 1.2-.7 13-11.8 26.1-24.8l23.7-23.7 23.8 23.7c13 13 24.8 24.1 26 24.8 5 2.5 12.9 1.2 17.6-2.9 4.4-3.9 6.2-13 3.6-18.3-.7-1.2-11.8-13-24.8-26.1L342.5 320l23.7-23.8c13-13 24.1-24.8 24.8-26 1.6-3.3 1.5-10.4-.4-14-3.4-6.5-11.1-9.9-18.1-8.1-3.3.9-8 5.1-28.2 25.2L320 297.4l-24.2-24.1c-20.1-19.9-25-24.3-28.3-25.2-4.8-1.3-4.1-1.3-8.8.3z"/></svg>',document.getElementById("closeSearchButton"));st.addEventListener("click",function(){O.style.display="block",st.style.display="none",it.style.display="none",ct.style.display="none",dt.style.display="none",mt.innerHTML=H,mt.style.display="inline"}),mt.addEventListener("click",function(){O.style.display="none",O.value="",st.style.display="inline",it.style.display="inline",ct.style.display="inline",dt.style.display="inline",mt.style.display="none",document.querySelectorAll(".previous-chats li").forEach(e=>e.style.display="list-item")}),O.addEventListener("input",function(){const o=O.value.toLowerCase(),r=JSON.parse(localStorage.getItem("chats"))||[];document.querySelectorAll(".previous-chats li").forEach((e,t)=>{var t=r.length-1-t,t=r[t],n=t.title.toLowerCase(),t=t.conversation.map(e=>e.content.toLowerCase()).join(" ");n.includes(o)||t.includes(o)?e.style.display="list-item":e.style.display="none"})}),it.addEventListener("click",function(){var e;confirm("Do you want to export the chats to the clipboard?")&&((e=localStorage.getItem("chats"))?navigator.clipboard.writeText(e).then(()=>alert("Chats exported to clipboard.")).catch(e=>console.error("Failed to copy chats: ",e)):alert("No chats available to export."))}),ct.addEventListener("click",function(){confirm("Do you want to import chats from the clipboard? You need to click the paste button after this confirming. If you import multiple chats, your previous chats history will be overwritten; if you import a single chat, the chat will be loaded.")&&navigator.clipboard.readText().then(t=>{try{var n=JSON.parse(t);if(Array.isArray(n))if(n[0].timestamp)localStorage.setItem("chats",JSON.stringify(n)),N(),P(),alert("Chats imported successfully.");else try{if(!n[0].role)throw Error("Invalid chat data.");g=n,lt()}catch(e){alert("Invalid chat data.")}else alert("Invalid chat data.")}catch(e){t=JSON.parse((n=(n=t).split("---\n").filter(e=>""!==e.trim()).map(e=>{var t=e.trim().match(/^\*(.*?)\*\s:/);return{role:t?t[1].toLowerCase():"",content:(t?e.replace(t[0],""):e).trim()}}),JSON.stringify(n)));try{if(!t[0].role)throw Error("Invalid chat data.");g=t,lt()}catch(e){alert("Invalid chat data.")}}}).catch(e=>console.error("Failed to read from clipboard: ",e))}),dt.addEventListener("click",function(){confirm("Do you want to delete all chats?")&&(localStorage.removeItem("chats"),N(),P(),alert("All chats deleted."))}),document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.classList.toggle("light-mode"),document.body.classList.contains("light-mode")?(localStorage.setItem("theme","light"),document.body.style.backgroundColor="#f1f1f1",document.documentElement.style.backgroundColor="#f1f1f1"):(localStorage.removeItem("theme"),document.body.style.backgroundColor="#333",document.documentElement.style.backgroundColor="#333")}),localStorage.getItem("theme")&&(document.body.classList.add("light-mode"),document.body.style.backgroundColor="#f1f1f1",document.documentElement.style.backgroundColor="#f1f1f1");const ut=document.getElementById("systemPromptsList");t=document.getElementById("saveSystemPromptButton");const pt=document.getElementById("loadPromptsModal");function ht(){var e=JSON.parse(localStorage.getItem("systemPrompts"))||[];ut.innerHTML="",e.forEach((e,n)=>{var t=document.createElement("li"),o=(t.textContent=e.name,t.addEventListener("click",()=>{we.value=e.content,B(we),document.getElementById("loadPromptsModal").style.display="none"}),document.createElement("button"));o.textContent="Delete",o.addEventListener("click",e=>{var t;e.stopPropagation(),e=n,(t=JSON.parse(localStorage.getItem("systemPrompts"))||[]).splice(e,1),localStorage.setItem("systemPrompts",JSON.stringify(t)),ht()}),t.appendChild(o),ut.appendChild(t)}),document.getElementById("loadPromptsModal").style.display="flex"}pt.querySelector(".close").addEventListener("click",function(){pt.style.display="none"}),window.addEventListener("click",function(e){e.target===pt&&(pt.style.display="none")}),t.addEventListener("click",function(){var e,t=prompt("Enter a name for the system prompt:"),n=we.value.trim();t&&n&&((e=JSON.parse(localStorage.getItem("systemPrompts"))||[]).push({name:t,content:n}),localStorage.setItem("systemPrompts",JSON.stringify(e)),alert("System prompt saved successfully!"))}),document.getElementById("loadSystemPromptButton").addEventListener("click",ht)});
document.addEventListener('DOMContentLoaded', function() {
    // Create modal container
    var modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '0';
    modal.style.left = '0';
    modal.style.width = '100%';
    modal.style.height = '100%';
    modal.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';
    modal.style.display = 'flex';
    modal.style.justifyContent = 'center';
    modal.style.alignItems = 'center';
    modal.style.zIndex = '1000';

    // Create modal content box
    var modalContent = document.createElement('div');
    modalContent.style.backgroundColor = '#333';
    modalContent.style.color = '#eee';
    modalContent.style.padding = '20px';
    modalContent.style.borderRadius = '5px';
    modalContent.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
    modalContent.style.textAlign = 'center';
    modalContent.style.width = '300px';

    // Create message
    var message = document.createElement('p');
    message.textContent = 'Help us keep this service free forever. Please consider making a donation!';
    modalContent.appendChild(message);

    // Create PayPal button
    var donateButton = document.createElement('a');
    donateButton.href = 'https://paypal.me/thefiredragon05';
    donateButton.textContent = 'Donate via PayPal';
    donateButton.style.display = 'inline-block';
    donateButton.style.marginTop = '10px';
    donateButton.style.padding = '10px 20px';
    donateButton.style.backgroundColor = '#0070ba';
    donateButton.style.color = '#fff';
    donateButton.style.textDecoration = 'none';
    donateButton.style.borderRadius = '5px';
    donateButton.style.fontWeight = 'bold';
    modalContent.appendChild(donateButton);

    // Create close button
    var closeButton = document.createElement('button');
    closeButton.textContent = 'Close';
    closeButton.style.display = 'block';
    closeButton.style.marginTop = '20px';
    closeButton.style.padding = '10px 20px';
    closeButton.style.backgroundColor = '#ccc';
    closeButton.style.border = 'none';
    closeButton.style.borderRadius = '5px';
    closeButton.style.cursor = 'pointer';
    closeButton.onclick = function() {
        modal.style.display = 'none';
    };
    modalContent.appendChild(closeButton);

    // Append content to modal and modal to body
    modal.appendChild(modalContent);
    document.body.appendChild(modal);
});
